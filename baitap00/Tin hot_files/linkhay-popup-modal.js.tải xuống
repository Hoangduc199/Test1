(function($, window, document) {
    var modalContainer;
    $.fn.linkHayAttachmentPopup = function(options) {
        // default options
        var editor = null;
        const settings = $.extend({
            container: 'attachment-popup-container',
            aspectRatio: {
                width: 16,
                height: 9
            },
            mobile: false
        }, options);

        var urls = {
            info: linkhay_post_url + '/actions/link/post/linkhay.php',
            upload: {
                image: linkhay_post_url + '/comment/item/upload'
            }
        };

        var element = $(this);

        var linkDataResponse;

        var initTemplate = function() {
            const templates =
                `
                <div id="${settings.container}" class="attachment-popup" data-mobile="${settings.mobile.toString()}">
                    <div class="modal-layout hidden">
                        <div class="modal">
                            <div class="modal-header">
                                <a class="tab layer-1 active" data-tag="image" id="tab-image-header">
                                    <svg class="tab-icon" width="20" height="20" viewBox="0 0 20 20"
                                        fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M3 2C2.44772 2 2 2.44772 2 3V17C2 17.5523 2.44772 18 3 18H17C17.5523 18 18 17.5523 18 17V3C18 2.44772 17.5523 2 17 2H3ZM0 3C0 1.34315 1.34315 0 3 0H17C18.6569 0 20 1.34315 20 3V17C20 18.6569 18.6569 20 17 20H3C1.34315 20 0 18.6569 0 17V3Z" />
                                        <path
                                            d="M6.5 6C6.22386 6 6 6.22386 6 6.5C6 6.77614 6.22386 7 6.5 7C6.77614 7 7 6.77614 7 6.5C7 6.22386 6.77614 6 6.5 6ZM4 6.5C4 5.11929 5.11929 4 6.5 4C7.88071 4 9 5.11929 9 6.5C9 7.88071 7.88071 9 6.5 9C5.11929 9 4 7.88071 4 6.5Z" />
                                        <path
                                            d="M13.2929 7.29289C13.6834 6.90237 14.3166 6.90237 14.7071 7.29289L19.7071 12.2929C20.0976 12.6834 20.0976 13.3166 19.7071 13.7071C19.3166 14.0976 18.6834 14.0976 18.2929 13.7071L14 9.41421L3.70711 19.7071C3.31658 20.0976 2.68342 20.0976 2.29289 19.7071C1.90237 19.3166 1.90237 18.6834 2.29289 18.2929L13.2929 7.29289Z" />
                                    </svg><span>Chèn ảnh</span>
                                </a>
                                <a class="tab layer-1" data-tag="link" id="tab-link-header">
                                    <svg class="tab-icon" width="24" height="12" viewBox="0 0 20 10"
                                        fill="none" xmlns="http://www.w3.org/2000/svg"
                                        style="margin-top: 4.5px;">
                                        <path
                                            d="M5 1.66667C4.11594 1.66667 3.2681 2.01786 2.64298 2.64298C2.01786 3.2681 1.66667 4.11594 1.66667 5C1.66667 5.88405 2.01786 6.7319 2.64298 7.35702C2.95251 7.66655 3.31997 7.91208 3.72439 8.0796C4.12881 8.24711 4.56226 8.33333 5 8.33333H7.5C7.96024 8.33333 8.33333 8.70643 8.33333 9.16667C8.33333 9.6269 7.96024 10 7.5 10H5C4.34339 10 3.69321 9.87067 3.08658 9.6194C2.47995 9.36812 1.92876 8.99983 1.46447 8.53553C0.526784 7.59785 0 6.32608 0 5C0 3.67392 0.526784 2.40215 1.46447 1.46447C2.40215 0.526784 3.67392 0 5 0H7.5C7.96024 0 8.33333 0.373096 8.33333 0.833333C8.33333 1.29357 7.96024 1.66667 7.5 1.66667H5ZM11.6667 0.833333C11.6667 0.373096 12.0398 0 12.5 0H15C15.6566 0 16.3068 0.129329 16.9134 0.380602C17.52 0.631876 18.0712 1.00017 18.5355 1.46447C18.9998 1.92876 19.3681 2.47995 19.6194 3.08658C19.8707 3.69321 20 4.34339 20 5C20 5.65661 19.8707 6.30679 19.6194 6.91342C19.3681 7.52004 18.9998 8.07124 18.5355 8.53553C18.0712 8.99983 17.52 9.36812 16.9134 9.6194C16.3068 9.87067 15.6566 10 15 10H12.5C12.0398 10 11.6667 9.6269 11.6667 9.16667C11.6667 8.70643 12.0398 8.33333 12.5 8.33333H15C15.4377 8.33333 15.8712 8.24711 16.2756 8.0796C16.68 7.91208 17.0475 7.66655 17.357 7.35702C17.6666 7.04749 17.9121 6.68003 18.0796 6.27561C18.2471 5.87119 18.3333 5.43774 18.3333 5C18.3333 4.56226 18.2471 4.12881 18.0796 3.72439C17.9121 3.31997 17.6666 2.95251 17.357 2.64298C17.0475 2.33345 16.68 2.08792 16.2756 1.9204C15.8712 1.75289 15.4377 1.66667 15 1.66667H12.5C12.0398 1.66667 11.6667 1.29357 11.6667 0.833333Z" />
                                        <path
                                            d="M5.83333 5C5.83333 4.53976 6.20643 4.16667 6.66667 4.16667H13.3333C13.7936 4.16667 14.1667 4.53976 14.1667 5C14.1667 5.46024 13.7936 5.83333 13.3333 5.83333H6.66667C6.20643 5.83333 5.83333 5.46024 5.83333 5Z" />
                                    </svg><span>Chèn link</span>
                                </a>
                                <a class="tab layer-1" data-tag="embed" id="tab-embed-header">
                                    <svg class="tab-icon" width="24" height="24" viewBox="0 0 20 12"
                                        fill="none" xmlns="http://www.w3.org/2000/svg"
                                        style="margin-top: -1px;">
                                        <path
                                            d="M12.9933 0.251051C13.3483 -0.0836838 13.9239 -0.0836838 14.279 0.251051L19.7335 5.39391C20.0885 5.72864 20.0885 6.27136 19.7335 6.60609L14.279 11.7489C13.9239 12.0837 13.3483 12.0837 12.9933 11.7489C12.6383 11.4142 12.6383 10.8715 12.9933 10.5368L17.805 6L12.9933 1.46323C12.6383 1.1285 12.6383 0.585786 12.9933 0.251051Z" />
                                        <path
                                            d="M7.00646 0.251051C7.36148 0.585786 7.36148 1.1285 7.00646 1.46323L2.19474 6L7.00646 10.5368C7.36148 10.8715 7.36148 11.4142 7.00646 11.7489C6.65144 12.0837 6.07583 12.0837 5.72081 11.7489L0.266267 6.60609C-0.0887555 6.27136 -0.0887555 5.72864 0.266267 5.39391L5.72081 0.251051C6.07583 -0.0836838 6.65144 -0.0836838 7.00646 0.251051Z" />
                                    </svg><span>Mã nhúng</span>
                                </a>
                                <a class="tab layer-2 hidden" data-tag="gif" id="tab-gif-header">
                                    <svg class="tab-icon" width="20" height="20" viewBox="0 0 20 20"
                                        fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M3 2C2.44772 2 2 2.44772 2 3V17C2 17.5523 2.44772 18 3 18H17C17.5523 18 18 17.5523 18 17V3C18 2.44772 17.5523 2 17 2H3ZM0 3C0 1.34315 1.34315 0 3 0H17C18.6569 0 20 1.34315 20 3V17C20 18.6569 18.6569 20 17 20H3C1.34315 20 0 18.6569 0 17V3Z" />
                                        <path
                                            d="M6.5 6C6.22386 6 6 6.22386 6 6.5C6 6.77614 6.22386 7 6.5 7C6.77614 7 7 6.77614 7 6.5C7 6.22386 6.77614 6 6.5 6ZM4 6.5C4 5.11929 5.11929 4 6.5 4C7.88071 4 9 5.11929 9 6.5C9 7.88071 7.88071 9 6.5 9C5.11929 9 4 7.88071 4 6.5Z" />
                                        <path
                                            d="M13.2929 7.29289C13.6834 6.90237 14.3166 6.90237 14.7071 7.29289L19.7071 12.2929C20.0976 12.6834 20.0976 13.3166 19.7071 13.7071C19.3166 14.0976 18.6834 14.0976 18.2929 13.7071L14 9.41421L3.70711 19.7071C3.31658 20.0976 2.68342 20.0976 2.29289 19.7071C1.90237 19.3166 1.90237 18.6834 2.29289 18.2929L13.2929 7.29289Z" />
                                    </svg>
                                    <span>Ảnh gif</span>
                                </a>
                                <a class="tab layer-2 hidden" data-tag="sticker" id="tab-sticker-header">
                                    <svg class="tab-icon" width="20" height="20" viewBox="0 0 20 20"
                                        fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M3 2C2.44772 2 2 2.44772 2 3V17C2 17.5523 2.44772 18 3 18H17C17.5523 18 18 17.5523 18 17V3C18 2.44772 17.5523 2 17 2H3ZM0 3C0 1.34315 1.34315 0 3 0H17C18.6569 0 20 1.34315 20 3V17C20 18.6569 18.6569 20 17 20H3C1.34315 20 0 18.6569 0 17V3Z" />
                                        <path
                                            d="M6.5 6C6.22386 6 6 6.22386 6 6.5C6 6.77614 6.22386 7 6.5 7C6.77614 7 7 6.77614 7 6.5C7 6.22386 6.77614 6 6.5 6ZM4 6.5C4 5.11929 5.11929 4 6.5 4C7.88071 4 9 5.11929 9 6.5C9 7.88071 7.88071 9 6.5 9C5.11929 9 4 7.88071 4 6.5Z" />
                                        <path
                                            d="M13.2929 7.29289C13.6834 6.90237 14.3166 6.90237 14.7071 7.29289L19.7071 12.2929C20.0976 12.6834 20.0976 13.3166 19.7071 13.7071C19.3166 14.0976 18.6834 14.0976 18.2929 13.7071L14 9.41421L3.70711 19.7071C3.31658 20.0976 2.68342 20.0976 2.29289 19.7071C1.90237 19.3166 1.90237 18.6834 2.29289 18.2929L13.2929 7.29289Z" />
                                    </svg>
                                    <span>Sticker</span>
                                </a>
                            </div>
                            <div class="modal-body">
                                <div class="tab-content image hidden" id="tab-image">
                                    <div class="pointer image"></div>
                                    <div class="image-preview-layout hidden"></div>
                                    <div class="tab-image-layout">
                                        <a class="btn-upload upload-image">
                                            <svg width="16" height="16" viewBox="0 0 16 16" fill="#616161"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M7.99989 7.33332C8.36808 7.33332 8.66656 7.6318 8.66656 7.99999V14C8.66656 14.3682 8.36808 14.6667 7.99989 14.6667C7.6317 14.6667 7.33323 14.3682 7.33323 14V7.99999C7.33323 7.6318 7.6317 7.33332 7.99989 7.33332Z" />
                                                <path
                                                    d="M5.77542 1.33903C6.68175 1.30564 7.58385 1.47814 8.41391 1.84357C9.24397 2.20901 9.98039 2.75786 10.5678 3.44886C11.0421 4.00681 11.4093 4.64572 11.6526 5.33332H11.9999C12.8886 5.33391 13.7522 5.63043 14.4537 6.17608C15.1551 6.72173 15.6549 7.48544 15.8741 8.34667C16.0933 9.20791 16.0195 10.1176 15.6642 10.9322C15.309 11.7468 14.6926 12.4199 13.9123 12.8453C13.5891 13.0216 13.1841 12.9024 13.0079 12.5791C12.8317 12.2558 12.9508 11.8509 13.2741 11.6747C13.7943 11.3911 14.2052 10.9423 14.4421 10.3993C14.6789 9.85618 14.7281 9.24971 14.582 8.67556C14.4358 8.1014 14.1026 7.59226 13.635 7.22849C13.1674 6.86473 12.5919 6.66705 11.9995 6.66666H11.1599C10.856 6.66666 10.5905 6.46111 10.5144 6.16686C10.3379 5.48392 10.0088 4.84989 9.55192 4.31244C9.09504 3.77499 8.52227 3.34811 7.87667 3.06388C7.23107 2.77966 6.52944 2.64549 5.82452 2.67146C5.1196 2.69743 4.42974 2.88287 3.8068 3.21383C3.18387 3.5448 2.64406 4.01267 2.22798 4.58228C1.81189 5.1519 1.53035 5.80842 1.40452 6.50251C1.27869 7.19659 1.31184 7.91017 1.50149 8.5896C1.69114 9.26902 2.03234 9.89662 2.49945 10.4252C2.74326 10.7011 2.71725 11.1224 2.44135 11.3662C2.16546 11.61 1.74415 11.584 1.50034 11.3081C0.899768 10.6285 0.461077 9.82161 0.217246 8.94806C-0.0265847 8.07452 -0.0692113 7.15706 0.0925713 6.26466C0.254354 5.37227 0.616336 4.52816 1.1513 3.7958C1.68627 3.06344 2.3803 2.46189 3.18122 2.03637C3.98214 1.61084 4.8691 1.37242 5.77542 1.33903Z" />
                                                <path
                                                    d="M7.52849 7.52858C7.78884 7.26824 8.21095 7.26824 8.4713 7.52858L11.138 10.1953C11.3983 10.4556 11.3983 10.8777 11.138 11.1381C10.8776 11.3984 10.4555 11.3984 10.1952 11.1381L7.99989 8.9428L5.80463 11.1381C5.54428 11.3984 5.12217 11.3984 4.86182 11.1381C4.60147 10.8777 4.60147 10.4556 4.86182 10.1953L7.52849 7.52858Z" />
                                            </svg>
                                            <span class="text-upload">Upload ảnh từ máy tính</span>
                                        </a>
                                        <a class="btn-upload get-link">
                                            <svg width="17" height="16" viewBox="0 0 17 16" fill="#616161"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M9.01691 1.83378C9.77132 1.10515 10.7817 0.701975 11.8305 0.711089C12.8793 0.720202 13.8826 1.14088 14.6242 1.88251C15.3658 2.62414 15.7865 3.62739 15.7956 4.67618C15.8047 5.72497 15.4015 6.73538 14.6729 7.48979L14.6648 7.49805L12.6649 9.49796C12.2594 9.90362 11.7714 10.2173 11.234 10.4178C10.6965 10.6183 10.1223 10.7008 9.55019 10.6598C8.97808 10.6189 8.42147 10.4553 7.91811 10.1803C7.41476 9.90531 6.97644 9.52527 6.63287 9.06596C6.41234 8.77113 6.47257 8.35334 6.7674 8.1328C7.06223 7.91226 7.48002 7.97249 7.70056 8.26732C7.9296 8.57353 8.22182 8.82689 8.55739 9.01023C8.89296 9.19356 9.26403 9.30259 9.64544 9.3299C10.0269 9.35722 10.4097 9.30219 10.7679 9.16854C11.1262 9.0349 11.4516 8.82576 11.7219 8.55532L13.7177 6.55956C14.201 6.05705 14.4684 5.38513 14.4623 4.68777C14.4562 3.98857 14.1758 3.31974 13.6814 2.82532C13.187 2.3309 12.5181 2.05045 11.8189 2.04437C11.1213 2.03831 10.4491 2.30591 9.94648 2.78967L8.80341 3.92609C8.54231 4.18568 8.1202 4.18445 7.86061 3.92334C7.60102 3.66223 7.60225 3.24012 7.86336 2.98053L9.01002 1.84053L9.01691 1.83378Z" />
                                                <path
                                                    d="M5.76615 5.58217C6.30356 5.3817 6.87779 5.29915 7.44991 5.34012C8.02202 5.3811 8.57863 5.54463 9.08199 5.81964C9.58534 6.09465 10.0237 6.47469 10.3672 6.93399C10.5878 7.22882 10.5275 7.64662 10.2327 7.86715C9.93787 8.08769 9.52008 8.02746 9.29954 7.73263C9.0705 7.42643 8.77828 7.17307 8.44271 6.98973C8.10714 6.80639 7.73607 6.69737 7.35466 6.67005C6.97325 6.64274 6.59043 6.69777 6.23216 6.83141C5.87389 6.96506 5.54855 7.17419 5.27821 7.44463L3.28245 9.44039C2.79909 9.94291 2.53172 10.6148 2.53778 11.3122C2.54386 12.0114 2.82431 12.6802 3.31873 13.1746C3.81315 13.6691 4.48198 13.9495 5.18117 13.9556C5.87854 13.9616 6.55045 13.6943 7.05296 13.2109L8.18865 12.0752C8.449 11.8149 8.87111 11.8149 9.13146 12.0752C9.3918 12.3356 9.3918 12.7577 9.13146 13.018L7.99146 14.158L7.98319 14.1662C7.22878 14.8948 6.21837 15.298 5.16959 15.2889C4.1208 15.2798 3.11755 14.8591 2.37592 14.1174C1.63429 13.3758 1.21361 12.3726 1.2045 11.3238C1.19538 10.275 1.59856 9.26458 2.32719 8.51017L2.33531 8.50191L4.33523 6.50199C4.3352 6.50202 4.33526 6.50196 4.33523 6.50199C4.74072 6.09638 5.22878 5.78262 5.76615 5.58217Z" />
                                            </svg>
                                            <span class="text-upload" style="margin-left: 10.7px;">Upload ảnh bằng URL</span>
                                        </a>
                                        <!-- <div class="tab-image-select">

                                        </div> -->
                                    </div>
                                    <input type="file" id="upload-file" style="display: none;"
                                        name="upload_file" accept="image/*">
                                </div>
                                <div class="tab-content hidden" id="tab-link">
                                    <div class="pointer link"></div>
                                    <div class="tab-link-layout">
                                        <svg width="12" height="6" viewBox="0 0 20 10" fill="#8E8E8E"
                                            style="margin: 17px 5px 17px 10px;"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M5 1.66667C4.11594 1.66667 3.2681 2.01786 2.64298 2.64298C2.01786 3.2681 1.66667 4.11594 1.66667 5C1.66667 5.88405 2.01786 6.7319 2.64298 7.35702C2.95251 7.66655 3.31997 7.91208 3.72439 8.0796C4.12881 8.24711 4.56226 8.33333 5 8.33333H7.5C7.96024 8.33333 8.33333 8.70643 8.33333 9.16667C8.33333 9.6269 7.96024 10 7.5 10H5C4.34339 10 3.69321 9.87067 3.08658 9.6194C2.47995 9.36812 1.92876 8.99983 1.46447 8.53553C0.526784 7.59785 0 6.32608 0 5C0 3.67392 0.526784 2.40215 1.46447 1.46447C2.40215 0.526784 3.67392 0 5 0H7.5C7.96024 0 8.33333 0.373096 8.33333 0.833333C8.33333 1.29357 7.96024 1.66667 7.5 1.66667H5ZM11.6667 0.833333C11.6667 0.373096 12.0398 0 12.5 0H15C15.6566 0 16.3068 0.129329 16.9134 0.380602C17.52 0.631876 18.0712 1.00017 18.5355 1.46447C18.9998 1.92876 19.3681 2.47995 19.6194 3.08658C19.8707 3.69321 20 4.34339 20 5C20 5.65661 19.8707 6.30679 19.6194 6.91342C19.3681 7.52004 18.9998 8.07124 18.5355 8.53553C18.0712 8.99983 17.52 9.36812 16.9134 9.6194C16.3068 9.87067 15.6566 10 15 10H12.5C12.0398 10 11.6667 9.6269 11.6667 9.16667C11.6667 8.70643 12.0398 8.33333 12.5 8.33333H15C15.4377 8.33333 15.8712 8.24711 16.2756 8.0796C16.68 7.91208 17.0475 7.66655 17.357 7.35702C17.6666 7.04749 17.9121 6.68003 18.0796 6.27561C18.2471 5.87119 18.3333 5.43774 18.3333 5C18.3333 4.56226 18.2471 4.12881 18.0796 3.72439C17.9121 3.31997 17.6666 2.95251 17.357 2.64298C17.0475 2.33345 16.68 2.08792 16.2756 1.9204C15.8712 1.75289 15.4377 1.66667 15 1.66667H12.5C12.0398 1.66667 11.6667 1.29357 11.6667 0.833333Z" />
                                            <path
                                                d="M5.83333 5C5.83333 4.53976 6.20643 4.16667 6.66667 4.16667H13.3333C13.7936 4.16667 14.1667 4.53976 14.1667 5C14.1667 5.46024 13.7936 5.83333 13.3333 5.83333H6.66667C6.20643 5.83333 5.83333 5.46024 5.83333 5Z" />
                                        </svg>
                                        <input type="text" class="tab-link-url"
                                            placeholder="Nhập đường dẫn (VD: http://example.com)">
                                        <div class="loading hidden" id="loading"></div>
                                        <svg class="tab-link-reset-url hidden" id="reset-url" width="12"
                                            height="11" viewBox="0 0 12 11" fill="#888888"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M11.5 1C11.7761 1 12 1.22386 12 1.5V4.5C12 4.77614 11.7761 5 11.5 5H8.5C8.22386 5 8 4.77614 8 4.5C8 4.22386 8.22386 4 8.5 4H11V1.5C11 1.22386 11.2239 1 11.5 1Z" />
                                            <path
                                                d="M1.50938e-06 6.5C1.50938e-06 6.22386 0.223859 6 0.500001 6H3.5C3.77614 6 4 6.22386 4 6.5C4 6.77614 3.77614 7 3.5 7H1V9.5C1 9.77614 0.776144 10 0.500001 10C0.223859 10 1.50938e-06 9.77614 1.50938e-06 9.5V6.5Z" />
                                            <path
                                                d="M7.10867 1.65751C6.45958 1.46977 5.77352 1.4495 5.11449 1.59862C4.45546 1.74773 3.84494 2.06136 3.3399 2.51025C2.83486 2.95913 2.45177 3.52863 2.22636 4.16562C2.13424 4.42594 1.84853 4.56229 1.5882 4.47018C1.32788 4.37805 1.19152 4.09234 1.28364 3.83202C1.5654 3.03579 2.04427 2.32391 2.67557 1.76281C3.30687 1.2017 4.07001 0.809666 4.8938 0.623274C5.71759 0.436881 6.57517 0.462209 7.38653 0.696893C8.1953 0.930832 8.93187 1.3652 9.52795 1.95966L11.8424 4.13444C12.0436 4.32354 12.0535 4.63997 11.8644 4.84121C11.6753 5.04245 11.3589 5.05229 11.1576 4.86319L8.83761 2.68319C8.83381 2.67962 8.83005 2.67598 8.82636 2.67228C8.34869 2.19438 7.75775 1.84526 7.10867 1.65751ZM0.135625 6.15643C0.324721 5.95519 0.64115 5.94534 0.84239 6.13444L3.16239 8.31444C3.1662 8.31802 3.16995 8.32166 3.17364 8.32535C3.65131 8.80326 4.24225 9.15237 4.89134 9.34012C5.54042 9.52787 6.22648 9.54813 6.88552 9.39902C7.54455 9.2499 8.15507 8.93627 8.6601 8.48739C9.16514 8.03851 9.54824 7.469 9.77364 6.83202C9.86576 6.57169 10.1515 6.43534 10.4118 6.52746C10.6721 6.61958 10.8085 6.90529 10.7164 7.16562C10.4346 7.96185 9.95573 8.67372 9.32443 9.23483C8.69314 9.79593 7.92999 10.188 7.1062 10.3744C6.28241 10.5608 5.42483 10.5354 4.61348 10.3007C3.8047 10.0668 3.06814 9.63243 2.47205 9.03797L0.157613 6.86319C-0.0436264 6.6741 -0.0534708 6.35767 0.135625 6.15643Z" />
                                        </svg>
                                        <svg class="tab-link-delete-url hidden" id="delete-url" width="10"
                                            height="10" viewBox="0 0 8 9" fill="#000000"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M7.83263 0.667368C8.05579 0.890524 8.05579 1.25233 7.83263 1.47549L0.97549 8.33263C0.752333 8.55579 0.390524 8.55579 0.167368 8.33263C-0.0557892 8.10948 -0.0557892 7.74767 0.167368 7.52451L7.02451 0.667368C7.24767 0.444211 7.60948 0.444211 7.83263 0.667368Z" />
                                            <path
                                                d="M0.167368 0.667368C0.390524 0.444211 0.752333 0.444211 0.97549 0.667368L7.83263 7.52451C8.05579 7.74767 8.05579 8.10948 7.83263 8.33263C7.60948 8.55579 7.24767 8.55579 7.02451 8.33263L0.167368 1.47549C-0.0557892 1.25233 -0.0557892 0.890524 0.167368 0.667368Z" />
                                        </svg>
                                    </div>

                                    <div class="tab-link-suggest-layout" id="tab-link-suggest-layout">
                                        <div class="tab-link-suggest-header">
                                            <div></div>
                                            <div style="display: flex;">
                                                <div class="tab-link-suggest-tab active" data-tab="style-1">
                                                    <svg width="20" height="4" viewBox="0 0 20 4"
                                                        fill="#AAAAAA" xmlns="http://www.w3.org/2000/svg">
                                                        <rect id="Rectangle 117" width="20" height="1" />
                                                        <rect id="Rectangle 118" y="3" width="9"
                                                            height="1" />
                                                    </svg>
                                                </div>
                                                <div class="tab-link-suggest-tab" data-tab="style-2">
                                                    <svg width="20" height="6" viewBox="0 0 20 6"
                                                        fill="#AAAAAA" xmlns="http://www.w3.org/2000/svg">
                                                        <rect x="10" y="1" width="10" height="1" />
                                                        <rect x="10" y="3" width="9" height="1" />
                                                        <rect width="9" height="6" />
                                                    </svg>
                                                </div>
                                                <div class="tab-link-suggest-tab video hidden"
                                                    data-tab="style-3">
                                                    <svg width="14" height="8" viewBox="0 0 20 12"
                                                        fill="#AAAAAA" xmlns="http://www.w3.org/2000/svg">
                                                        <path
                                                            d="M12.9933 0.251051C13.3483 -0.0836838 13.9239 -0.0836838 14.279 0.251051L19.7335 5.39391C20.0885 5.72864 20.0885 6.27136 19.7335 6.60609L14.279 11.7489C13.9239 12.0837 13.3483 12.0837 12.9933 11.7489C12.6383 11.4142 12.6383 10.8715 12.9933 10.5368L17.805 6L12.9933 1.46323C12.6383 1.1285 12.6383 0.585786 12.9933 0.251051Z" />
                                                        <path
                                                            d="M7.00646 0.251051C7.36148 0.585786 7.36148 1.1285 7.00646 1.46323L2.19474 6L7.00646 10.5368C7.36148 10.8715 7.36148 11.4142 7.00646 11.7489C6.65144 12.0837 6.07583 12.0837 5.72081 11.7489L0.266267 6.60609C-0.0887555 6.27136 -0.0887555 5.72864 0.266267 5.39391L5.72081 0.251051C6.07583 -0.0836838 6.65144 -0.0836838 7.00646 0.251051Z" />
                                                    </svg>
                                                </div>
                                            </div>
                                            <div class="btn-delete-suggess">
                                                <svg class="btn-delete-suggess-icon" width="10" height="10"
                                                    viewBox="0 0 10 11" fill="#333333"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                                        d="M0 2.77266C0 2.52162 0.223858 2.31812 0.5 2.31812H9.5C9.77614 2.31812 10 2.52162 10 2.77266C10 3.0237 9.77614 3.22721 9.5 3.22721H0.5C0.223858 3.22721 0 3.0237 0 2.77266Z" />
                                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                                        d="M4 1.40909C3.86739 1.40909 3.74021 1.45698 3.64645 1.54222C3.55268 1.62747 3.5 1.74308 3.5 1.86364V2.31818H6.5V1.86364C6.5 1.74308 6.44732 1.62747 6.35355 1.54222C6.25978 1.45698 6.13261 1.40909 6 1.40909H4ZM7.5 2.31818V1.86364C7.5 1.50198 7.34196 1.15513 7.06066 0.8994C6.77936 0.643668 6.39782 0.5 6 0.5H4C3.60217 0.5 3.22064 0.643668 2.93934 0.8994C2.65804 1.15513 2.5 1.50198 2.5 1.86364V2.31818H1.5C1.22386 2.31818 1 2.52169 1 2.77273V9.13636C1 9.49802 1.15804 9.84487 1.43934 10.1006C1.72064 10.3563 2.10217 10.5 2.5 10.5H7.5C7.89782 10.5 8.27936 10.3563 8.56066 10.1006C8.84196 9.84487 9 9.49802 9 9.13636V2.77273C9 2.52169 8.77614 2.31818 8.5 2.31818H7.5ZM2 3.22727V9.13636C2 9.25692 2.05268 9.37253 2.14645 9.45778C2.24021 9.54302 2.36739 9.59091 2.5 9.59091H7.5C7.63261 9.59091 7.75978 9.54302 7.85355 9.45778C7.94732 9.37253 8 9.25692 8 9.13636V3.22727H2Z" />
                                                </svg>
                                                <span class="btn-delete-suggess-text">Xóa</span>
                                            </div>
                                        </div>
                                        <div class="tab-link-suggest-body">
                                            <div class="tab-link-suggest-style" id="style-1">
                                                <div class="tab-link-suggest-title">
                                                    <span></span>
                                                    <svg width="8" height="8" viewBox="0 0 8 8"
                                                        fill="#AAAAAA" xmlns="http://www.w3.org/2000/svg">
                                                        <path
                                                            d="M1.2 2C1.09391 2 0.992172 2.04214 0.917157 2.11716C0.842143 2.19217 0.8 2.29391 0.8 2.4V6.8C0.8 6.90609 0.842143 7.00783 0.917157 7.08284C0.992172 7.15786 1.09391 7.2 1.2 7.2H5.6C5.70609 7.2 5.80783 7.15786 5.88284 7.08284C5.95786 7.00783 6 6.90609 6 6.8V4.4C6 4.17909 6.17909 4 6.4 4C6.62091 4 6.8 4.17909 6.8 4.4V6.8C6.8 7.11826 6.67357 7.42348 6.44853 7.64853C6.22348 7.87357 5.91826 8 5.6 8H1.2C0.88174 8 0.576515 7.87357 0.351472 7.64853C0.126428 7.42348 0 7.11826 0 6.8V2.4C0 2.08174 0.126428 1.77652 0.351472 1.55147C0.576515 1.32643 0.88174 1.2 1.2 1.2H3.6C3.82091 1.2 4 1.37909 4 1.6C4 1.82091 3.82091 2 3.6 2H1.2Z" />
                                                        <path
                                                            d="M4.8 0.4C4.8 0.179086 4.97909 1.19209e-08 5.2 1.19209e-08H7.6C7.82091 1.19209e-08 8 0.179086 8 0.4V2.8C8 3.02091 7.82091 3.2 7.6 3.2C7.37909 3.2 7.2 3.02091 7.2 2.8V0.8H5.2C4.97909 0.8 4.8 0.620914 4.8 0.4Z" />
                                                        <path
                                                            d="M7.88284 0.117157C8.03905 0.273367 8.03905 0.526633 7.88284 0.682843L4.85427 3.71141C4.69806 3.86762 4.4448 3.86762 4.28859 3.71141C4.13238 3.5552 4.13238 3.30194 4.28859 3.14573L7.31716 0.117157C7.47337 -0.0390524 7.72663 -0.0390524 7.88284 0.117157Z" />
                                                    </svg>
                                                </div>
                                                <span class="tab-link-suggest-url"></span>
                                            </div>
                                            <div class="tab-link-suggest-style hidden" id="style-2"
                                                style="display: flex;">
                                                <img class="tab-link-suggest-image" src="" alt="">
                                                <div class="tab-link-suggest-right-style-2">
                                                    <div class="tab-link-suggest-title">
                                                        <span></span>
                                                        <svg width="8" height="8" viewBox="0 0 8 8"
                                                            fill="#AAAAAA"
                                                            xmlns="http://www.w3.org/2000/svg">
                                                            <path
                                                                d="M1.2 2C1.09391 2 0.992172 2.04214 0.917157 2.11716C0.842143 2.19217 0.8 2.29391 0.8 2.4V6.8C0.8 6.90609 0.842143 7.00783 0.917157 7.08284C0.992172 7.15786 1.09391 7.2 1.2 7.2H5.6C5.70609 7.2 5.80783 7.15786 5.88284 7.08284C5.95786 7.00783 6 6.90609 6 6.8V4.4C6 4.17909 6.17909 4 6.4 4C6.62091 4 6.8 4.17909 6.8 4.4V6.8C6.8 7.11826 6.67357 7.42348 6.44853 7.64853C6.22348 7.87357 5.91826 8 5.6 8H1.2C0.88174 8 0.576515 7.87357 0.351472 7.64853C0.126428 7.42348 0 7.11826 0 6.8V2.4C0 2.08174 0.126428 1.77652 0.351472 1.55147C0.576515 1.32643 0.88174 1.2 1.2 1.2H3.6C3.82091 1.2 4 1.37909 4 1.6C4 1.82091 3.82091 2 3.6 2H1.2Z" />
                                                            <path
                                                                d="M4.8 0.4C4.8 0.179086 4.97909 1.19209e-08 5.2 1.19209e-08H7.6C7.82091 1.19209e-08 8 0.179086 8 0.4V2.8C8 3.02091 7.82091 3.2 7.6 3.2C7.37909 3.2 7.2 3.02091 7.2 2.8V0.8H5.2C4.97909 0.8 4.8 0.620914 4.8 0.4Z" />
                                                            <path
                                                                d="M7.88284 0.117157C8.03905 0.273367 8.03905 0.526633 7.88284 0.682843L4.85427 3.71141C4.69806 3.86762 4.4448 3.86762 4.28859 3.71141C4.13238 3.5552 4.13238 3.30194 4.28859 3.14573L7.31716 0.117157C7.47337 -0.0390524 7.72663 -0.0390524 7.88284 0.117157Z" />
                                                        </svg>
                                                    </div>
                                                    <span class="tab-link-suggest-url"></span>
                                                </div>
                                            </div>
                                            <div class="tab-link-suggest-style hidden" id="style-3">
                                                <div class="tab-link-embed-preview"></div>
                                                <div class="tab-link-suggest-right-style-3">
                                                    <div class="tab-link-suggest-title">
                                                        <span></span>
                                                        <svg width="8" height="8" viewBox="0 0 8 8"
                                                            fill="#AAAAAA"
                                                            xmlns="http://www.w3.org/2000/svg">
                                                            <path
                                                                d="M1.2 2C1.09391 2 0.992172 2.04214 0.917157 2.11716C0.842143 2.19217 0.8 2.29391 0.8 2.4V6.8C0.8 6.90609 0.842143 7.00783 0.917157 7.08284C0.992172 7.15786 1.09391 7.2 1.2 7.2H5.6C5.70609 7.2 5.80783 7.15786 5.88284 7.08284C5.95786 7.00783 6 6.90609 6 6.8V4.4C6 4.17909 6.17909 4 6.4 4C6.62091 4 6.8 4.17909 6.8 4.4V6.8C6.8 7.11826 6.67357 7.42348 6.44853 7.64853C6.22348 7.87357 5.91826 8 5.6 8H1.2C0.88174 8 0.576515 7.87357 0.351472 7.64853C0.126428 7.42348 0 7.11826 0 6.8V2.4C0 2.08174 0.126428 1.77652 0.351472 1.55147C0.576515 1.32643 0.88174 1.2 1.2 1.2H3.6C3.82091 1.2 4 1.37909 4 1.6C4 1.82091 3.82091 2 3.6 2H1.2Z" />
                                                            <path
                                                                d="M4.8 0.4C4.8 0.179086 4.97909 1.19209e-08 5.2 1.19209e-08H7.6C7.82091 1.19209e-08 8 0.179086 8 0.4V2.8C8 3.02091 7.82091 3.2 7.6 3.2C7.37909 3.2 7.2 3.02091 7.2 2.8V0.8H5.2C4.97909 0.8 4.8 0.620914 4.8 0.4Z" />
                                                            <path
                                                                d="M7.88284 0.117157C8.03905 0.273367 8.03905 0.526633 7.88284 0.682843L4.85427 3.71141C4.69806 3.86762 4.4448 3.86762 4.28859 3.71141C4.13238 3.5552 4.13238 3.30194 4.28859 3.14573L7.31716 0.117157C7.47337 -0.0390524 7.72663 -0.0390524 7.88284 0.117157Z" />
                                                        </svg>
                                                    </div>
                                                    <span class="tab-link-suggest-url"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-content hidden" id="tab-embed">
                                    <div class="pointer embed"></div>
                                    <div class="tab-embed-layout">
                                        <svg width="12" height="8" viewBox="0 0 20 12" fill="#888888"
                                            style="margin: 19px 10px;" xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M12.9933 0.251051C13.3483 -0.0836838 13.9239 -0.0836838 14.279 0.251051L19.7335 5.39391C20.0885 5.72864 20.0885 6.27136 19.7335 6.60609L14.279 11.7489C13.9239 12.0837 13.3483 12.0837 12.9933 11.7489C12.6383 11.4142 12.6383 10.8715 12.9933 10.5368L17.805 6L12.9933 1.46323C12.6383 1.1285 12.6383 0.585786 12.9933 0.251051Z" />
                                            <path
                                                d="M7.00646 0.251051C7.36148 0.585786 7.36148 1.1285 7.00646 1.46323L2.19474 6L7.00646 10.5368C7.36148 10.8715 7.36148 11.4142 7.00646 11.7489C6.65144 12.0837 6.07583 12.0837 5.72081 11.7489L0.266267 6.60609C-0.0887555 6.27136 -0.0887555 5.72864 0.266267 5.39391L5.72081 0.251051C6.07583 -0.0836838 6.65144 -0.0836838 7.00646 0.251051Z" />
                                        </svg>
                                        <textarea type="text" class="tab-embed-text"
                                            placeholder="Nhập mã nhúng iframe từ website..."></textarea>
                                    </div>
                                    <div class="tab-embed-suggest-layout hidden">
                                        <div class="tab-embed-suggest-header">
                                            <span class="tab-embed-suggest-header-label">Xem trước</span>
                                            <div class="tab-embed loading hidden"></div>
                                            <div class="reset hidden">
                                                <svg width="12" height="11" viewBox="0 0 12 11"
                                                    fill="#888888" xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M11.5 1C11.7761 1 12 1.22386 12 1.5V4.5C12 4.77614 11.7761 5 11.5 5H8.5C8.22386 5 8 4.77614 8 4.5C8 4.22386 8.22386 4 8.5 4H11V1.5C11 1.22386 11.2239 1 11.5 1Z" />
                                                    <path
                                                        d="M1.50938e-06 6.5C1.50938e-06 6.22386 0.223859 6 0.500001 6H3.5C3.77614 6 4 6.22386 4 6.5C4 6.77614 3.77614 7 3.5 7H1V9.5C1 9.77614 0.776144 10 0.500001 10C0.223859 10 1.50938e-06 9.77614 1.50938e-06 9.5V6.5Z" />
                                                    <path
                                                        d="M7.10867 1.65751C6.45958 1.46977 5.77352 1.4495 5.11449 1.59862C4.45546 1.74773 3.84494 2.06136 3.3399 2.51025C2.83486 2.95913 2.45177 3.52863 2.22636 4.16562C2.13424 4.42594 1.84853 4.56229 1.5882 4.47018C1.32788 4.37805 1.19152 4.09234 1.28364 3.83202C1.5654 3.03579 2.04427 2.32391 2.67557 1.76281C3.30687 1.2017 4.07001 0.809666 4.8938 0.623274C5.71759 0.436881 6.57517 0.462209 7.38653 0.696893C8.1953 0.930832 8.93187 1.3652 9.52795 1.95966L11.8424 4.13444C12.0436 4.32354 12.0535 4.63997 11.8644 4.84121C11.6753 5.04245 11.3589 5.05229 11.1576 4.86319L8.83761 2.68319C8.83381 2.67962 8.83005 2.67598 8.82636 2.67228C8.34869 2.19438 7.75775 1.84526 7.10867 1.65751ZM0.135625 6.15643C0.324721 5.95519 0.64115 5.94534 0.84239 6.13444L3.16239 8.31444C3.1662 8.31802 3.16995 8.32166 3.17364 8.32535C3.65131 8.80326 4.24225 9.15237 4.89134 9.34012C5.54042 9.52787 6.22648 9.54813 6.88552 9.39902C7.54455 9.2499 8.15507 8.93627 8.6601 8.48739C9.16514 8.03851 9.54824 7.469 9.77364 6.83202C9.86576 6.57169 10.1515 6.43534 10.4118 6.52746C10.6721 6.61958 10.8085 6.90529 10.7164 7.16562C10.4346 7.96185 9.95573 8.67372 9.32443 9.23483C8.69314 9.79593 7.92999 10.188 7.1062 10.3744C6.28241 10.5608 5.42483 10.5354 4.61348 10.3007C3.8047 10.0668 3.06814 9.63243 2.47205 9.03797L0.157613 6.86319C-0.0436264 6.6741 -0.0534708 6.35767 0.135625 6.15643Z" />
                                                </svg>
                                            </div>
                                        </div>
                                        <div class="tab-embed-suggest-body">
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-content hidden" id="tab-gif">
                                    <div class="gifs-container">
                                        <div class="editor-gifs-search">
                                            <div class="gifts-search-input">
                                                <input type="text" placeholder="Enter keywords here to search GIFs..." />
                                                <i class="fa fa-search"></i>
                                            </div>
                                            <button class="gifts-upload"><i class="fa fa-plus"></i> <span>Upload new GIF</span></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-content hidden" id="tab-sticker">
                                    <div class="stickers-container">
                                        <div class="editor-stickers-search">
                                            <div class="gifts-stickers-input">
                                                
                                            </div>
                                            <button class="stickers-upload"><i class="fa fa-plus"></i> <span>Upload Sticker</span></button>
                                        </div>
                                        <div class="editor-stickers-list"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn-cancel"> Hủy bỏ </button>
                                <button class="btn-insert disable" id="btn-insert" disabled="disable"> Chèn xuống </button>
                                <button class="btn-quick-comment disable hidden" id="btn-quick-comment" disabled="disable"> Bình luận ngay </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-layout-image hidden">
                        <div class="modal-image">
                            <div class="modal-image-header">
                                <span class="modal-image-header-content">Upload ảnh bằng URL</span>
                                <button class="close"></button>
                            </div>
                            <div class="modal-image-body">
                                <input class="modal-image-link" type="text">
                            </div>
                            <div class="modal-image-footer">
                                <button class="btn-image-cancel"><span class="btn-image-cancel-label">HỦY BỎ</span></button>
                                <button class="btn-image-accept"><span class="btn-image-accept-label">Sử dụng URL</span></button>
                            </div>
                        </div>
                        <div class="modal-image select-image hidden">
                            <div class="modal-image-header">
                                <span class="modal-image-header-content">Chọn ảnh từ URL để upload</span>
                                <button class="close"></button>
                            </div>
                            <div class="modal-image-body select-image">
                            </div>
                            <div class="modal-image-footer">
                                <button class="btn-image-cancel"><span class="btn-image-cancel-label">HỦY BỎ</span></button>
                                <button class="btn-image-insert success"><span
                                        class="btn-image-accept-label">Upload ảnh</span></button>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            if ($('#' + settings.container).length <= 0) {
                $(element).append(templates);

                modalContainer = $('#' + settings.container);
                // setupActions();
            }

        };

        var setupActions = function() {
            //cancel modal:
            modalContainer.find('.btn-cancel').on('click', closeQuillModal);
            //change tab on modal header:
            modalContainer.find('.modal-header').find('.tab').on('click', switchModalTab);
            //click upload image button:
            modalContainer.find('.upload-image').on('click', clickUploadImage);
            //click upload image by url:
            modalContainer.find('.get-link').on('click', clickGetLink);
            //input of upload file changed:
            modalContainer.find('#upload-file').on('input', changeUploadFile);
            //click button of submit Image by Url step 1
            modalContainer.find('.btn-image-accept').on('click', clickBtnImage);
            //click button of submit Image by Url step 2
            modalContainer.find('.btn-image-insert').on('click', submitUrlImageUpload);
            //click button of cancel Image by Url step 2
            modalContainer.find('.btn-image-cancel').on('click', cancelUrlImageUpload);
            //click button close modal
            modalContainer.find('.modal-image-header .close').on('click', cancelUrlImageUpload);
            // after fill a link:
            modalContainer.find('.tab-link-url').on('input', changeTabLinkUrl);
            //click remove item in suggest box
            modalContainer.find('.btn-delete-suggess').on('click', clickBtnDelete);
            //click remove input of link url
            modalContainer.find('.tab-link-delete-url').on('click', clickTabLinkDeleteUrl);
            //click refresh input of link url
            modalContainer.find('.tab-link-reset-url').on('click', clickTabLinkResetUrl);
            // switch tab of link after fill a link:
            modalContainer.find('.tab-link-suggest-tab').on('click', clickTabLinkSuggestTab);
            // after fill a embed:
            modalContainer.find('.tab-embed-text').on('input', changeEmbedText);
            //submit:
            modalContainer.find('.btn-insert').on('click', submitForm);
            //delete image item:
            $(document).on('click', '.delete-image', clickDeleteImage);
            //close modal
            modalContainer.find('.modal-layout').on('click', closeModal);

        };

        var removeActions = function() {
            //turn off events (to prevent duplicate events)
            modalContainer.find('.btn-cancel').off('click', closeQuillModal);

            modalContainer.find('.modal-header').find('.tab').off('click', switchModalTab);

            modalContainer.find('.upload-image').off('click', clickUploadImage);

            modalContainer.find('.get-link').off('click', clickGetLink);

            modalContainer.find('#upload-file').off('input', changeUploadFile);

            modalContainer.find('.btn-image-accept').off('click', clickBtnImage);

            modalContainer.find('.btn-image-insert').off('click', submitUrlImageUpload);

            modalContainer.find('.btn-image-cancel').off('click', cancelUrlImageUpload);

            modalContainer.find('.tab-link-url').off('input', changeTabLinkUrl);

            modalContainer.find('.btn-delete-suggess').off('click', clickBtnDelete);

            modalContainer.find('.tab-link-delete-url').off('click', clickTabLinkDeleteUrl);

            modalContainer.find('.tab-link-reset-url').off('click', clickTabLinkResetUrl);

            modalContainer.find('.tab-link-suggest-tab').off('click', clickTabLinkSuggestTab);

            modalContainer.find('.tab-embed-text').off('change', changeEmbedText);

            modalContainer.find('.btn-insert').off('click', submitForm);

            $(document).off('click', '.delete-image', clickDeleteImage);

            modalContainer.find('.modal-layout').off('click', closeModal);

        };
        this.showImage = function() {
            toggleModal('image');
        };

        this.showLink = function() {
            toggleModal('link');
        };

        this.editLink = function(e, id) {
            editor = e;
            toggleModal('link');
            let attachment = editor.getAttachmentValue(id);
            if (null == linkDataResponse) linkDataResponse = {};
            linkDataResponse['data'] = attachment;
            modalContainer.find('.tab-link-url').val(attachment.src);
            renderLinkPreview(attachment);

            return this;
        }

        this.showEmbed = function() {
            toggleModal('embed');
        };

        this.showGif = function() {
            toggleModal('gif');
        };

        this.showSticker = function() {
            toggleModal('sticker');
        };

        this.initialize = function() {
            initTemplate();
            // modalContainer = $('#' + settings.container);

            // setupActions();
            return this;
        };

        this.setEditor = function(e) {
            editor = e;
            return this;
        }

        this.editEmbed = function(e, id) {
            editor = e;
            toggleModal('embed');
            let attachment = editor.getAttachmentValue(id);
            modalContainer.find('.tab-embed-text').val(attachment.src);
            changeEmbedText();
            modalContainer.find('.tab.layer-1').attr('disabled', true);

            return this;
        };

        this.deleteEmbed = function () {
            modalContainer.find('#tab-embed-header').removeAttr('disabled');
        }

        this.insertLink = function(url, source, callback) {
            insertLink(url, source, callback);
        };

        this.syncLink = function(attachment) {
            let attachmentObj = {
                type: 'link',
                id: attachment.id,
                src: attachment.src,
                domain: attachment.domain,
                is_pending: 0,
                style: attachment.style,
                title: attachment.title,
                image_src: attachment.image_src,
                embed_code: attachment.embed_code
            };

            let linkData = {
                data: {
                    title: attachment.title,
                    domain: attachment.domain,
                    url: attachment.src,
                    image_src: attachment.image_src,
                    embed_code: attachment.embed_code
                }
            };

            const linkRender = renderAttachmentLink(linkData, attachmentObj.id);

            let link = $(linkRender);
            link.find('.attachment-link-tab').removeClass('active');
            link.find(`.attachment-link-tab[data-tab="tab-${attachmentObj.style}"]`).addClass('active');
            link.find('.attachment-link-content').removeClass('active');
            link.find('.attachment-link-layout').find(`.tab-${attachmentObj.style}`).addClass('active');
            link.find('.attachment-link-header').addClass('hidden');
            link.find('.attachment-link-header-success').removeClass('hidden');
            link.find('.attachment-link-layout').addClass('success');

            if (attachmentObj.style == 3) link.addClass('tab-3');

            $("#" + settings.attachmentId + '-items').append(link);

            resizeAttachmentLink(attachmentObj.id);

            //loading success
            $(editor).find("a[href='" + attachmentObj.src + "']:not([data-id])").removeClass('loading').attr('data-id', attachmentObj.id);
            return attachmentObj;
        }

        this.syncImage = function(attachment) {
            let attachmentObj = {
                type : 'image',
                id : attachment.id,
                src : attachment.src,
                is_pending: 0,
                hash: attachment.hash
            };

            let imageRender = `<div class="image-list" id='${attachmentObj.id}'>
                <div>
                    <img class="attach-image" src='${attachmentObj.src}' data-hash="${attachmentObj.hash}">
                    <div class="delete-attach-img">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="16" fill="black" fill-opacity="0.7"/>
                        <path d="M9.33337 12C9.33337 11.6319 9.63185 11.3334 10 11.3334H22C22.3682 11.3334 22.6667 11.6319 22.6667 12C22.6667 12.3682 22.3682 12.6667 22 12.6667H10C9.63185 12.6667 9.33337 12.3682 9.33337 12Z" fill="white"/>
                        <path fill-rule="evenodd" d="M14.6666 9.99996C14.4898 9.99996 14.3202 10.0702 14.1952 10.1952C14.0702 10.3202 14 10.4898 14 10.6666V11.3333H18V10.6666C18 10.4898 17.9297 10.3202 17.8047 10.1952C17.6797 10.0702 17.5101 9.99996 17.3333 9.99996H14.6666ZM19.3333 11.3333V10.6666C19.3333 10.1362 19.1226 9.62748 18.7475 9.25241C18.3724 8.87734 17.8637 8.66663 17.3333 8.66663H14.6666C14.1362 8.66663 13.6275 8.87734 13.2524 9.25241C12.8773 9.62748 12.6666 10.1362 12.6666 10.6666V11.3333H11.3333C10.9651 11.3333 10.6666 11.6318 10.6666 12V21.3333C10.6666 21.8637 10.8773 22.3724 11.2524 22.7475C11.6275 23.1226 12.1362 23.3333 12.6666 23.3333H19.3333C19.8637 23.3333 20.3724 23.1226 20.7475 22.7475C21.1226 22.3724 21.3333 21.8637 21.3333 21.3333V12C21.3333 11.6318 21.0348 11.3333 20.6666 11.3333H19.3333ZM12 12.6666V21.3333C12 21.5101 12.0702 21.6797 12.1952 21.8047C12.3202 21.9297 12.4898 22 12.6666 22H19.3333C19.5101 22 19.6797 21.9297 19.8047 21.8047C19.9297 21.6797 20 21.5101 20 21.3333V12.6666H12Z" fill="white"/>
                        </svg>
                    </div>
                </div>
            </div>`

            $("#" + settings.attachmentId + '-items').append(imageRender);
            modalContainer.find(".image-preview-layout").addClass('hidden');
            modalContainer.find(".tab-image-layout").removeClass('hidden');
        }

        this.syncEmbed = function(attachment) {
            let source = attachment.src;
            let attachmentObj = {
                'type' : 'embed',
                'id' : attachment.id,
                'src' : source,
                'is_pending': 0
            };

            let dataEmbed = encodeURIComponent(source);
            let embedRender = source ?
                `<div class="embed-list" id='${attachment.id}'>
                                    <div class="attachment-embed-header-success">
                                        <div style="display: flex;">
                                            <button class="attachment-embed-option" data-embed=${dataEmbed}>
                                                <svg width="12" height="13" viewBox="0 0 12 13" fill="#333333" style="margin-right: 7px;" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M6 5.5C5.44772 5.5 5 5.94772 5 6.5C5 7.05228 5.44772 7.5 6 7.5C6.55228 7.5 7 7.05228 7 6.5C7 5.94772 6.55228 5.5 6 5.5ZM4 6.5C4 5.39543 4.89543 4.5 6 4.5C7.10457 4.5 8 5.39543 8 6.5C8 7.60457 7.10457 8.5 6 8.5C4.89543 8.5 4 7.60457 4 6.5Z"/>
                                                <path d="M6 1.5C5.86739 1.5 5.74022 1.55268 5.64645 1.64645C5.55268 1.74022 5.5 1.86739 5.5 2V2.08699C5.49897 2.3454 5.4224 2.59786 5.27972 2.81331C5.13704 3.02875 4.93448 3.19778 4.69697 3.29957C4.65469 3.31769 4.61021 3.32985 4.56481 3.33578C4.34899 3.41136 4.11666 3.42999 3.8905 3.38898C3.63 3.34175 3.38963 3.21756 3.20037 3.03243L3.19642 3.02857L3.16645 2.99855C3.12001 2.95206 3.06467 2.91499 3.00397 2.88983C2.94327 2.86466 2.87821 2.85171 2.8125 2.85171C2.74679 2.85171 2.68173 2.86466 2.62103 2.88983C2.56033 2.91499 2.50519 2.95187 2.45875 2.99836L2.45836 2.99875C2.41187 3.04519 2.37499 3.10033 2.34983 3.16103C2.32466 3.22173 2.31171 3.28679 2.31171 3.3525C2.31171 3.41821 2.32466 3.48327 2.34983 3.54397C2.37499 3.60467 2.41187 3.65981 2.45836 3.70625L2.49245 3.74035C2.67758 3.9296 2.80175 4.17 2.84898 4.4305C2.89527 4.68581 2.86556 4.94898 2.76373 5.18739C2.67094 5.43066 2.50849 5.64134 2.29652 5.79294C2.08027 5.94761 1.82249 6.03365 1.55669 6.03986L1.545 6.04H1.5C1.36739 6.04 1.24022 6.09268 1.14645 6.18645C1.05268 6.28022 1 6.40739 1 6.54C1 6.67261 1.05268 6.79978 1.14645 6.89355C1.24022 6.98732 1.36739 7.04 1.5 7.04H1.58699C1.8454 7.04103 2.09786 7.1176 2.31331 7.26028C2.528 7.40246 2.6966 7.60412 2.79851 7.84056C2.90454 8.08213 2.93605 8.34988 2.88898 8.6095C2.84175 8.87 2.71756 9.11037 2.53243 9.29963L2.52857 9.30358L2.49855 9.33355C2.45206 9.37999 2.41499 9.43533 2.38983 9.49603C2.36466 9.55673 2.35171 9.62179 2.35171 9.6875C2.35171 9.75321 2.36466 9.81827 2.38983 9.87897C2.41499 9.93967 2.45187 9.99481 2.49836 10.0413L2.49875 10.0416C2.54519 10.0881 2.60033 10.125 2.66103 10.1502C2.72173 10.1753 2.78679 10.1883 2.8525 10.1883C2.91821 10.1883 2.98327 10.1753 3.04397 10.1502C3.10467 10.125 3.15981 10.0881 3.20625 10.0416L3.24035 10.0075C3.4296 9.82242 3.67 9.69825 3.9305 9.65102C4.18581 9.60473 4.44898 9.63443 4.68738 9.73627C4.93066 9.82905 5.14133 9.99151 5.29294 10.2035C5.44761 10.4197 5.53365 10.6775 5.53986 10.9433L5.54 10.955V11C5.54 11.1326 5.59268 11.2598 5.68645 11.3536C5.78022 11.4473 5.90739 11.5 6.04 11.5C6.17261 11.5 6.29978 11.4473 6.39355 11.3536C6.48732 11.2598 6.54 11.1326 6.54 11V10.915L6.54 10.913C6.54103 10.6546 6.6176 10.4021 6.76028 10.1867C6.90248 9.97198 7.10415 9.80337 7.34062 9.70147C7.58217 9.59545 7.8499 9.56395 8.1095 9.61102C8.37 9.65825 8.61037 9.78244 8.79963 9.96757L8.80357 9.97143L8.83355 10.0014C8.87999 10.0479 8.93533 10.085 8.99603 10.1102C9.05673 10.1353 9.12179 10.1483 9.1875 10.1483C9.25321 10.1483 9.31827 10.1353 9.37897 10.1102C9.43967 10.085 9.49481 10.0481 9.54125 10.0016L9.54164 10.0012C9.58813 9.95481 9.62501 9.89967 9.65017 9.83897C9.67534 9.77827 9.68829 9.71321 9.68829 9.6475C9.68829 9.58179 9.67534 9.51673 9.65017 9.45603C9.62501 9.39533 9.58813 9.34018 9.54164 9.29375L9.50755 9.25965C9.32242 9.0704 9.19825 8.83 9.15102 8.5695C9.10395 8.3099 9.13545 8.04217 9.24147 7.80062C9.34337 7.56415 9.51198 7.36248 9.72669 7.22028C9.94214 7.0776 10.1946 7.00103 10.453 7L10.455 7L10.5 7C10.6326 7 10.7598 6.94732 10.8536 6.85355C10.9473 6.75978 11 6.63261 11 6.5C11 6.36739 10.9473 6.24022 10.8536 6.14645C10.7598 6.05268 10.6326 6 10.5 6H10.415L10.413 6C10.1546 5.99897 9.90214 5.9224 9.68669 5.77972C9.47125 5.63704 9.30223 5.43448 9.20043 5.19697C9.18231 5.15469 9.17015 5.11021 9.16422 5.0648C9.08864 4.84899 9.07001 4.61666 9.11102 4.3905C9.15825 4.13 9.28244 3.88963 9.46757 3.70037L9.47142 3.69643L9.50144 3.66645C9.54793 3.62001 9.58501 3.56467 9.61017 3.50397C9.63534 3.44327 9.64829 3.37821 9.64829 3.3125C9.64829 3.24679 9.63534 3.18173 9.61017 3.12103C9.58501 3.06033 9.54813 3.00519 9.50164 2.95875L9.50125 2.95836C9.45481 2.91187 9.39967 2.87499 9.33897 2.84983C9.27827 2.82466 9.21321 2.81171 9.1475 2.81171C9.08179 2.81171 9.01673 2.82466 8.95603 2.84983C8.89533 2.87499 8.84019 2.91187 8.79375 2.95836L8.75965 2.99245C8.5704 3.17758 8.33 3.30175 8.0695 3.34898C7.80988 3.39605 7.54213 3.36454 7.30056 3.25851C7.06412 3.1566 6.86246 2.988 6.72028 2.77331C6.5776 2.55786 6.50103 2.3054 6.5 2.04699L6.5 2.045V2C6.5 1.86739 6.44732 1.74022 6.35355 1.64645C6.25978 1.55268 6.13261 1.5 6 1.5ZM9.7 8L10.1574 8.20188C10.1312 8.26129 10.1234 8.32719 10.135 8.39109C10.1464 8.45428 10.1764 8.51265 10.2209 8.55883L10.2484 8.58625C10.2483 8.58619 10.2484 8.58631 10.2484 8.58625C10.3877 8.72552 10.4985 8.89108 10.5739 9.07309C10.6494 9.25519 10.6883 9.45038 10.6883 9.6475C10.6883 9.84462 10.6494 10.0398 10.5739 10.2219C10.4985 10.404 10.3878 10.5694 10.2484 10.7087L9.895 10.355L10.2488 10.7084C10.1094 10.8478 9.94401 10.9585 9.76191 11.0339C9.57981 11.1094 9.38462 11.1483 9.1875 11.1483C8.99038 11.1483 8.79519 11.1094 8.61309 11.0339C8.43108 10.9585 8.26571 10.8479 8.12645 10.7086C8.12651 10.7086 8.12638 10.7085 8.12645 10.7086L8.09883 10.6809C8.05265 10.6364 7.99428 10.6064 7.93109 10.595C7.86719 10.5834 7.80129 10.5912 7.74188 10.6174L7.73698 10.6196C7.67872 10.6446 7.62902 10.686 7.59403 10.7388C7.55917 10.7915 7.5404 10.8531 7.54 10.9163V11C7.54 11.3978 7.38196 11.7794 7.10066 12.0607C6.81936 12.342 6.43783 12.5 6.04 12.5C5.64217 12.5 5.26064 12.342 4.97934 12.0607C4.69804 11.7794 4.54 11.3978 4.54 11V10.9622C4.53763 10.8986 4.51663 10.837 4.47957 10.7852C4.44163 10.7322 4.38861 10.6918 4.32741 10.6693C4.31752 10.6656 4.30775 10.6617 4.29812 10.6574C4.23871 10.6312 4.17281 10.6234 4.10891 10.635C4.04571 10.6464 3.98733 10.6764 3.94115 10.721L3.91375 10.7484C3.91381 10.7483 3.91369 10.7484 3.91375 10.7484C3.77448 10.8877 3.60892 10.9985 3.42691 11.0739C3.24481 11.1494 3.04962 11.1883 2.8525 11.1883C2.65538 11.1883 2.46019 11.1494 2.27809 11.0739C2.09617 10.9985 1.93087 10.888 1.79164 10.7488C1.65218 10.6094 1.54154 10.444 1.46605 10.2619C1.39057 10.0798 1.35171 9.88462 1.35171 9.6875C1.35171 9.49038 1.39057 9.29519 1.46605 9.11309C1.54154 8.93099 1.65218 8.76556 1.79164 8.62625L1.81906 8.59884C1.86364 8.55265 1.89357 8.49429 1.90502 8.43109C1.91661 8.36719 1.90879 8.30129 1.88257 8.24188L1.8804 8.23698C1.85544 8.17872 1.814 8.12902 1.76116 8.09403C1.70852 8.05917 1.64687 8.0404 1.58375 8.04H1.5C1.10217 8.04 0.720644 7.88196 0.43934 7.60066C0.158035 7.31936 0 6.93782 0 6.54C0 6.14218 0.158035 5.76064 0.43934 5.47934C0.720644 5.19804 1.10217 5.04 1.5 5.04H1.53782C1.60142 5.03763 1.66296 5.01663 1.71478 4.97957C1.76782 4.94163 1.80822 4.88862 1.83073 4.82741C1.83437 4.81752 1.83832 4.80775 1.84257 4.79812C1.86879 4.73871 1.87661 4.67281 1.86502 4.60891C1.85356 4.54571 1.82364 4.48734 1.77905 4.44116L1.75164 4.41375C1.61218 4.27444 1.50154 4.10901 1.42605 3.92691C1.35057 3.74481 1.31171 3.54962 1.31171 3.3525C1.31171 3.15538 1.35057 2.96019 1.42605 2.77809C1.5015 2.59608 1.61207 2.43072 1.75145 2.29145C1.89072 2.15207 2.05608 2.0415 2.23809 1.96605C2.42019 1.89057 2.61538 1.85171 2.8125 1.85171C3.00962 1.85171 3.20481 1.89057 3.38691 1.96605C3.56901 2.04154 3.73444 2.15218 3.87375 2.29164L3.90115 2.31905C3.94734 2.36364 4.00571 2.39356 4.06891 2.40502C4.13281 2.41661 4.19871 2.40879 4.25812 2.38257C4.29014 2.36844 4.32346 2.35775 4.35754 2.35061C4.3924 2.32695 4.42249 2.29662 4.44597 2.26116C4.48083 2.20852 4.4996 2.14687 4.5 2.08375V2C4.5 1.60217 4.65804 1.22064 4.93934 0.93934C5.22064 0.658035 5.60218 0.5 6 0.5C6.39782 0.5 6.77936 0.658035 7.06066 0.93934C7.34196 1.22064 7.5 1.60217 7.5 2V2.04375C7.5004 2.10687 7.51917 2.16852 7.55403 2.22116C7.58902 2.274 7.63871 2.31546 7.69697 2.34043L7.70189 2.34254C7.7613 2.36876 7.82719 2.37661 7.89109 2.36502C7.95429 2.35357 8.01265 2.32364 8.05884 2.27906L8.08625 2.25164C8.22556 2.11218 8.39099 2.00154 8.57309 1.92605C8.75519 1.85057 8.95038 1.81171 9.1475 1.81171C9.34462 1.81171 9.53981 1.85057 9.72191 1.92605C9.90401 2.00154 10.0694 2.11218 10.2087 2.25164C10.348 2.39087 10.4585 2.55616 10.5339 2.73809C10.6094 2.92019 10.6483 3.11538 10.6483 3.3125C10.6483 3.50962 10.6094 3.70481 10.5339 3.88691C10.4585 4.06892 10.3479 4.23428 10.2086 4.37355C10.2086 4.37349 10.2085 4.37362 10.2086 4.37355L10.181 4.40115C10.1364 4.44734 10.1064 4.50571 10.095 4.56891C10.0834 4.63281 10.0912 4.69871 10.1174 4.75812C10.1316 4.79014 10.1423 4.82346 10.1494 4.85753C10.1731 4.8924 10.2034 4.92249 10.2388 4.94597C10.2915 4.98083 10.3531 4.9996 10.4163 5H10.5C10.8978 5 11.2794 5.15804 11.5607 5.43934C11.842 5.72064 12 6.10217 12 6.5C12 6.89783 11.842 7.27936 11.5607 7.56066C11.2794 7.84196 10.8978 8 10.5 8H10.4563C10.3931 8.0004 10.3315 8.01917 10.2788 8.05403C10.226 8.08902 10.1845 8.13871 10.1596 8.19697L9.7 8Z" />
                                                </svg><span class="label">Tùy chỉnh</span>
                                            </button>
                                            <button class="attachment-embed-delete">
                                                <svg width="10" height="11" viewBox="0 0 10 11" fill="#333333" style="margin-right: 7px;" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M0 2.7729C0 2.52187 0.223858 2.31836 0.5 2.31836H9.5C9.77614 2.31836 10 2.52187 10 2.7729C10 3.02394 9.77614 3.22745 9.5 3.22745H0.5C0.223858 3.22745 0 3.02394 0 2.7729Z" />
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M4 1.40909C3.86739 1.40909 3.74021 1.45698 3.64645 1.54222C3.55268 1.62747 3.5 1.74308 3.5 1.86364V2.31818H6.5V1.86364C6.5 1.74308 6.44732 1.62747 6.35355 1.54222C6.25978 1.45698 6.13261 1.40909 6 1.40909H4ZM7.5 2.31818V1.86364C7.5 1.50198 7.34196 1.15513 7.06066 0.8994C6.77936 0.643668 6.39782 0.5 6 0.5H4C3.60217 0.5 3.22064 0.643668 2.93934 0.8994C2.65804 1.15513 2.5 1.50198 2.5 1.86364V2.31818H1.5C1.22386 2.31818 1 2.52169 1 2.77273V9.13636C1 9.49802 1.15804 9.84487 1.43934 10.1006C1.72064 10.3563 2.10217 10.5 2.5 10.5H7.5C7.89782 10.5 8.27936 10.3563 8.56066 10.1006C8.84196 9.84487 9 9.49802 9 9.13636V2.77273C9 2.52169 8.77614 2.31818 8.5 2.31818H7.5ZM2 3.22727V9.13636C2 9.25692 2.05268 9.37253 2.14645 9.45778C2.24021 9.54302 2.36739 9.59091 2.5 9.59091H7.5C7.63261 9.59091 7.75978 9.54302 7.85355 9.45778C7.94732 9.37253 8 9.25692 8 9.13636V3.22727H2Z"/>
                                                </svg><span class="label">Xóa</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="embed-content">
                                        ${source}
                                    </div>
                                </div>` : '<div class="embed-list"></div>';
            //disable embed button
            if (source) {
                editor.find('.ql-video').attr('disabled', true);
                modalContainer.find('#tab-embed-header').attr('disabled', true);
            }

            $("#" + settings.attachmentId + '-items').append(embedRender);
        };

        var toggleModal = function(type) {
            setupActions();

            modalContainer.find('.modal-layout').removeClass('hidden');
            document.body.style.overflow = "hidden";
            switchTab(type);
        }

        var closeQuillModal = function(e) {
            e.preventDefault();
            removeActions();

            document.body.style.overflow = "";
            modalContainer.find('.modal-layout').addClass('hidden');
            modalContainer.find('.btn-insert').attr('disabled', 'disabled');
            modalContainer.find('#btn-quick-comment').attr('disabled', 'disabled');
            // modalContainer.find('#reset-url').addClass('hidden');
            // modalContainer.find('#delete-url').addClass('hidden');
            modalContainer.find("#delete-url").attr('class','tab-link-delete-url hidden');
            modalContainer.find("#reset-url").attr('class','tab-link-reset-url hidden');

            modalContainer.find('.image-preview-layout').html('').addClass('hidden');
            modalContainer.find('.tab-image-layout').removeClass('hidden');
            modalContainer.find('.tab-link-url').val('');
            modalContainer.find('.tab-link-suggest-layout').removeClass('active').removeAttr('data-id');
            modalContainer.find('.tab-embed-text').val('');
            modalContainer.find('.tab-embed-suggest-layout').addClass('hidden');

            modalContainer.find('.tab.layer-1').removeAttr('disabled');
            if (editor.find('.ql-video').attr('disabled')) {
                modalContainer.find('#tab-embed-header').attr('disabled', true);
            }
        }

        var closeModal = function(e) {
            var modal = modalContainer.find('.modal');
            if (! modal.is(e.target) && modal.has(e.target).length === 0) {
                closeQuillModal(e);
            }
        }

        var switchModalTab = function(e) {
            e.preventDefault();
            var type = $(e.currentTarget).data('tag');
            var disabledTab = modalContainer.find('#tab-'+ type +'-header').attr('disabled');

            if (disabledTab) {
                return;
            }
            switchTab(type);
        }

        var changeUploadFile = function(e) {
            var files = modalContainer.find("#upload-file").get(0).files,
                totalFile = files.length;
            if (totalFile > 0) {
                //
                let formData = new FormData();
                formData.append('link_id', editor.getLinkId());
                formData.append('type', 'image');
                formData.append('file', files[0]);
                formData.append('data', 'UploadImage');
                $.ajaxq('comment-upload-image', {
                    type: "POST",
                    data: formData,
                    contentType: false,
                    processData: false,
                    crossDomain: true,
                    xhrFields: {withCredentials: true},
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-OSC-Cross-Request': 'OK'
                    },
                    url: urls.upload.image,
                    success: function (response) {
                        if (response.result !== 'OK') {
                            console.log('Upload error: ' + response.message);
                        } else {
                            modalContainer.find('.image-preview-layout').html(renderImageByURL(response.data.url, response.data.hash));
                        }

                        modalContainer.find('.image-preview-layout').removeClass('hidden');
                        modalContainer.find('.tab-image-layout').addClass('hidden');
                        modalContainer.find('.btn-insert').attr("disabled", false).attr('data-type', 'image');
                    }
                });
            }
        }

        var clickDeleteImage = function(e) {
            modalContainer.find('.image-preview-layout').addClass('hidden').html('');
            modalContainer.find('.tab-image-layout').removeClass('hidden');
            modalContainer.find('.btn-insert').attr("disabled", true);
            modalContainer.find('#upload-file').val('');
        }

        var clickUploadImage = function() {
            modalContainer.find('#upload-file').click();
        }

        var clickBtnImageCancel = function() {
            modalContainer.find('.modal-image-link').val('');
            modalContainer.find('.modal-layout-image').addClass('hidden');
        }

        var changeInputRadioImage = function() {
            let imgLayout = $(this).parent();
            if ($(this).is(":checked")) {
                modalContainer.find('.select-img').removeClass('success');
                imgLayout.addClass('success');
            }
        }

        var clickGetLink = function () {
            modalContainer.find('.modal-layout-image').removeClass('hidden');
        }

        var clickBtnImage = function () {
            var self = $(this);
            let url = modalContainer.find('.modal-image-link').val();
            let listImageElement = modalContainer.find('.modal-image-body.select-image');
            listImageElement.empty();
            if (url.length > 0) {
                let formData = new FormData();
                formData.append('link_id', editor.getLinkId());
                formData.append('type', 'image');
                formData.append('url', url);
                $.ajaxq('comment-upload-image', {
                    type: "POST",
                    data: formData,
                    contentType: false,
                    processData: false,
                    crossDomain: true,
                    xhrFields: {withCredentials: true},
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-OSC-Cross-Request': 'OK'
                    },
                    url: urls.upload.image,
                    beforeSend: function() {
                        $(self).children('span').html('Đang tải dữ liệu...');
                        $(self).attr('disabled', true);
                    },
                    success: function (response) {
                        $(self).children('span').html('Sử dụng URL');
                        $(self).removeAttr('disabled');

                        if (response.result !== 'OK') {
                            console.log('Upload error: ' + response.message);
                        } else {
                            if (typeof(response.data.selector) !== 'undefined' && response.data.selector === true && response.data.images.length > 0) {
                                for (let i = 0; i < response.data.images.length; i++) {
                                    let key = i + 1;
                                    listImageElement.append(
                                        `<div class="show-image-layout">
                                                <img class="modal-image-img" src="${response.data.images[i].url}" data-src="${response.data.images[i].url}" data-hash="${response.data.images[i].hash}" alt="" />
                                                <div class="select-img">
                                                    <input type="radio" class="radio" name="image" id="checkbox-${key}" data-src="${response.data.images[i].url}" data-hash="${response.data.images[i].hash}" />
                                                    <label class="select-img-title" for="checkbox-${key}"></label>
                                                </div>
                                            </div>`);
                                }
                            } else {
                                let key = 1;
                                listImageElement.append(
                                    `<div class="show-image-layout">
                                                <img class="modal-image-img" src="${response.data.url}" data-src="${response.data.url}" data-hash="${response.data.hash}" alt="">
                                                <div class="select-img">
                                                    <input type="radio" class="radio" name="image" id="checkbox-${key}" data-src="${response.data.url}" data-hash="${response.data.hash}" />
                                                    <label class="select-img-title" for="checkbox-${key}"></label>
                                                </div>
                                            </div>`);
                            }
                            listImageElement.find('.select-img').first().addClass('success')
                                .find('input').prop('checked', true);
                            modalContainer.find('input:radio[name="image"]').on('change', changeInputRadioImage);
                            modalContainer.find('img.modal-image-img').click(function() {
                                $(this).parents('.show-image-layout').find('.select-img-title').click();
                            });
                        }

                        modalContainer.find('.modal-image').addClass('hidden');
                        modalContainer.find('.select-image').removeClass('hidden');
                        modalContainer.find('.modal-image-link').val('');
                    }
                });
            }
        }

        var submitUrlImageUpload = function () {
            let selectImage = modalContainer.find('input.radio:checked');

            if (selectImage.data('src')) {
                let renderImage = renderImageByURL(selectImage.data('src'), selectImage.data('hash'));
                modalContainer.find('.image-preview-layout').html(renderImage).removeClass('hidden');

                modalContainer.find('.tab-image-layout').addClass('hidden');
            }

            refreshModalImageSelect();
            modalContainer.find('.modal-layout-image').addClass('hidden');
            modalContainer.find('.btn-insert').attr("disabled", false).attr('data-type', 'image');
        };

        var cancelUrlImageUpload = function () {
            refreshModalImageSelect();
        };

        var changeTabLinkUrl = function (style) {
            let url = modalContainer.find('.tab-link-url').val();
            if (url.trim() == '') {
                return;
            }
            modalContainer.find('#loading').removeClass('hidden').css({ 'position': 'static' });
            // modalContainer.find("#delete-url").addClass('hidden');
            // modalContainer.find("#reset-url").addClass('hidden');
            modalContainer.find("#delete-url").attr('class','tab-link-delete-url hidden');
            modalContainer.find("#reset-url").attr('class','tab-link-reset-url hidden');

            $.ajaxq('url_info', {
                type: 'POST',
                url: urls.info,
                xhrFields: {withCredentials: true},
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-OSC-Cross-Request': 'OK'
                },
                data: {
                    url: url,
                    act: 'info',
                    request_type: 'ajax'
                },
                dataType: 'json',
                beforeSend: function() {
                    modalContainer.find('#loading').removeClass('hidden');
                },
                success: function(response) {
                    modalContainer.find('#loading').addClass('hidden');

                    if (response.result !== 'OK') {
                        modalContainer.find('.tab-link-url').val('');
                        modalContainer.find('.tab-link-suggest-layout').removeClass('active');
                    } else {
                        linkDataResponse = {
                            data: {
                                title: response.info.title,
                                domain: response.info.domain,
                                url: response.info.url,
                                image_src: response.info.images.length > 0 ? response.info.images[0][0] : '',
                            }
                        };
                        if (typeof(response.info.embed.code) !== 'undefined') {
                            linkDataResponse.data.embed_code = response.info.embed.code;
                        }
                        renderLinkPreview(linkDataResponse.data)
                    }

                    if (typeof style !== 'undefined') {
                        $(`.tab-link-suggest-tab[data-tab="${style}"]`).click();
                    }
                }
            });
        }

        var renderLinkPreview = function(data) {
            modalContainer.find('.tab-link-suggest-layout').addClass('active').attr('data-id', data.id);
            modalContainer.find('.tab-link-suggest-title span').html(data.title);
            modalContainer.find('.tab-link-suggest-url').html(data.domain);
            modalContainer.find('.tab-link-suggest-image').attr('src', data.image_src);
            modalContainer.find('.btn-insert').attr("disabled", false).attr('data-type', 'link');
            modalContainer.find("#delete-url").attr('class', 'tab-link-delete-url');
            modalContainer.find("#reset-url").attr('class', 'tab-link-reset-url').removeClass('hidden');
            modalContainer.find('.tab-link-suggest-tab').removeClass('active');
            // modalContainer.find("#reset-url").removeClass('hidden');
            if (! data.style) {
                data.style = data.embed_code ? 3 : 1;
            }

            modalContainer.find('.tab-link-suggest-tab.video').addClass('hidden');
            modalContainer.find('.tab-link-suggest-style').addClass('hidden');
            modalContainer.find('.tab-link-suggest-tab[data-tab="style-'+ data.style +'"]').addClass('active').click();

            if (data.embed_code) {
                modalContainer.find('.tab-link-suggest-tab.video').removeClass('hidden');
                var embedPreview = modalContainer.find('.tab-link-suggest-style#style-3 .tab-link-embed-preview').html(data.embed_code);
                var iframeWidth = embedPreview.find('iframe').attr('width');
                embedPreview.css({
                    width: iframeWidth,
                    height: iframeWidth * settings.aspectRatio.height / settings.aspectRatio.width
                })
                embedPreview.next().width(iframeWidth);
            }
        }

        var clickBtnDelete = function() {
            modalContainer.find('.tab-link-suggest-layout').removeClass('active');
        }

        var clickTabLinkDeleteUrl = function() {
            modalContainer.find('.tab-link-url').val('');
            modalContainer.find('.tab-link-suggest-layout').removeClass('active');
            modalContainer.find('.btn-insert').attr('data-type', '');
            // modalContainer.find('#delete-url').addClass('hidden');
            // modalContainer.find('#reset-url').addClass('hidden');
            modalContainer.find("#delete-url").attr('class','tab-link-delete-url hidden');
            modalContainer.find("#reset-url").attr('class','tab-link-reset-url hidden');
        }

        var clickTabLinkResetUrl = function() {
            $('.tab-link-suggest-layout').addClass('active');
        }

        var clickTabLinkSuggestTab = function(e) {
            modalContainer.find('.tab-link-suggest-tab').removeClass('active');
            $(e.currentTarget).addClass('active');
            var style = $(e.currentTarget).data('tab');
            modalContainer.find('.tab-link-suggest-style').addClass('hidden');
            modalContainer.find('.tab-link-suggest-style#' + style).removeClass('hidden');
        };

        var changeEmbedText = function(e) {
            var embedPreview = modalContainer.find('.tab-embed-suggest-body').html('');
            let strEmbed = modalContainer.find('.tab-embed-text').val();
            if (strEmbed.trim() == '') {
                return;
            }
            const regexp = /^<iframe[^>]+src=["|']+([^"|']+)["|']+[^>]*>\s*<\/iframe>$/ig;
            const iframes = [...strEmbed.matchAll(regexp)];
            if (iframes.length != 1) {
                return;
            }

            const options = {
                whiteList: {
                    iframe: ['src', 'width', 'height', 'title', 'frameborder', 'allow', 'allowfullscreen']
                }
            }
            strEmbed = typeof filterXSS == 'function' ? filterXSS(strEmbed, options) : strEmbed;
            modalContainer.find('.tab-embed-suggest-layout').removeClass('hidden');
            modalContainer.find('.loading').removeClass('hidden').css({'position': 'static'}).next().addClass('hidden');
            var embedInput = modalContainer.find('.tab-embed-text');
            embedInput.height('');
            embedInput.height(embedInput[0].scrollHeight);
            var embedIframe = embedPreview.html(strEmbed).find('iframe');
            embedIframe.css({
                width: '100%',
                height: embedPreview.width() * embedIframe.height() / embedIframe.width()
            })
            setTimeout(() => {
                modalContainer.find('.loading').addClass('hidden');
                modalContainer.find('.reset').removeClass('hidden');
                modalContainer.find('.btn-insert').attr("disabled", false).attr('data-type', 'embed');
            }, 2000);
        };

        var submitForm = function (e) {
            $(e.target).attr("disabled", true);
            document.body.classList.remove('body-scroll');
            modalContainer.find('.modal-layout').addClass('hidden');
            var type   = $(e.target).attr('data-type');
            var url    = modalContainer.find('.tab-link-url').val();
            var embed  = modalContainer.find('.tab-embed-text').val();
            // var option = $(e.target).attr('data-option');

            modalContainer.find('.tab-link-url').val('');
            modalContainer.find('.tab-embed-text').val('');
            modalContainer.find('.tab-embed-suggest-layout').addClass('hidden');
            modalContainer.find('.tab-link-suggest-layout').removeClass('active');
            modalContainer.find('.image-preview-layout').addClass('hidden');
            modalContainer.find('.tab-image-layout').removeClass('hidden');
            modalContainer.find("#delete-url").attr('class','tab-link-delete-url hidden');
            modalContainer.find("#reset-url").attr('class','tab-link-reset-url hidden');
            document.body.style.overflow = "";
            removeActions();

            switch (type) {
                case 'image':
                    insertImage();
                    break;
                case 'link':
                    insertLink(url);
                    break;
                case 'embed':
                    insertEmbed(embed);
                    break;
                default:
                    break;
            }

        };

        var switchTab = function(type) {
            modalContainer.find('.tab-content').addClass('hidden');
            modalContainer.find('.tab').removeClass('active');

            switch(type) {
                case "image":
                default:
                    modalContainer.find('#tab-image').removeClass('hidden');
                    modalContainer.find('#tab-image-header').addClass('active');
                    modalContainer.find('.layer-2').addClass('hidden');
                    modalContainer.find('.layer-1').removeClass('hidden');
                    modalContainer.find('#btn-quick-comment').addClass('hidden');
                    modalContainer.find('.btn-insert').removeClass('hidden')
                        .attr("disabled", true)
                        .attr('data-type', 'image');
                    break;

                case "link":
                    modalContainer.find('#tab-link').removeClass('hidden');
                    modalContainer.find('#tab-link-header').addClass('active');
                    modalContainer.find('.layer-2').addClass('hidden');
                    modalContainer.find('.layer-1').removeClass('hidden');
                    modalContainer.find('#btn-quick-comment').addClass('hidden');
                    modalContainer.find('.btn-insert').removeClass('hidden')
                        .attr("disabled", true)
                        .attr('data-type', 'link');
                    let styleActive = modalContainer.find('.tab-link-suggest-tab.active:first');
                    let style = '';
                    if (styleActive) {
                        style = styleActive.attr('data-tab');
                    }
                    changeTabLinkUrl(style);
                    break;

                case "embed":
                    modalContainer.find('#tab-embed').removeClass('hidden');
                    modalContainer.find('#tab-embed-header').addClass('active');
                    modalContainer.find('.layer-2').addClass('hidden');
                    modalContainer.find('.layer-1').removeClass('hidden');
                    modalContainer.find('#btn-quick-comment').addClass('hidden');
                    modalContainer.find('.btn-insert').removeClass('hidden')
                        .attr("disabled", true)
                        .attr('data-type', 'embed');
                    changeEmbedText(modalContainer.find('.tab-embed-text'));
                    break;

                case "gif":
                    modalContainer.find('#tab-gif').removeClass('hidden');
                    modalContainer.find('#tab-gif-header').addClass('active');
                    modalContainer.find('.layer-2').removeClass('hidden');
                    modalContainer.find('.layer-1').addClass('hidden');

                    modalContainer.find('#btn-quick-comment').removeClass('hidden');
                    modalContainer.find('.btn-insert').addClass('hidden');

                    break;
                case "sticker":
                    modalContainer.find('#tab-sticker').removeClass('hidden');
                    modalContainer.find('#tab-sticker-header').addClass('active');
                    modalContainer.find('.layer-2').removeClass('hidden');
                    modalContainer.find('.layer-1').addClass('hidden');
                    modalContainer.find('#btn-quick-comment').removeClass('hidden');
                    modalContainer.find('.btn-insert').addClass('hidden');
                    break;
            }
        }

        var renderImageByURL = function(src, hash) {
            let response =
                `<img class="image-preview" src="${src}" data-hash="${hash}">
            <div class="delete-image-layout">
                  <svg class="delete-image" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect width="32" height="32" rx="16" fill="black" fill-opacity="0.7"/>
                  <path d="M9.33337 12C9.33337 11.6319 9.63185 11.3334 10 11.3334H22C22.3682 11.3334 22.6667 11.6319 22.6667 12C22.6667 12.3682 22.3682 12.6667 22 12.6667H10C9.63185 12.6667 9.33337 12.3682 9.33337 12Z" fill="white"/>
                  <path fill-rule="evenodd" d="M14.6666 9.99996C14.4898 9.99996 14.3202 10.0702 14.1952 10.1952C14.0702 10.3202 14 10.4898 14 10.6666V11.3333H18V10.6666C18 10.4898 17.9297 10.3202 17.8047 10.1952C17.6797 10.0702 17.5101 9.99996 17.3333 9.99996H14.6666ZM19.3333 11.3333V10.6666C19.3333 10.1362 19.1226 9.62748 18.7475 9.25241C18.3724 8.87734 17.8637 8.66663 17.3333 8.66663H14.6666C14.1362 8.66663 13.6275 8.87734 13.2524 9.25241C12.8773 9.62748 12.6666 10.1362 12.6666 10.6666V11.3333H11.3333C10.9651 11.3333 10.6666 11.6318 10.6666 12V21.3333C10.6666 21.8637 10.8773 22.3724 11.2524 22.7475C11.6275 23.1226 12.1362 23.3333 12.6666 23.3333H19.3333C19.8637 23.3333 20.3724 23.1226 20.7475 22.7475C21.1226 22.3724 21.3333 21.8637 21.3333 21.3333V12C21.3333 11.6318 21.0348 11.3333 20.6666 11.3333H19.3333ZM12 12.6666V21.3333C12 21.5101 12.0702 21.6797 12.1952 21.8047C12.3202 21.9297 12.4898 22 12.6666 22H19.3333C19.5101 22 19.6797 21.9297 19.8047 21.8047C19.9297 21.6797 20 21.5101 20 21.3333V12.6666H12Z" fill="white"/>
                  </svg>
            </div>`;
            return response;
        }

        var insertImage = function() {
            let src = modalContainer.find('.image-preview').attr('src'),
                hash = modalContainer.find('.image-preview').data('hash');
            const id = new Date().getTime();
            let imageRender = `<div class="image-list" id='${id}'>
                <div>
                    <img class="attach-image" src='${src}' data-hash="${hash}">
                    <div class="delete-attach-img">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="32" height="32" rx="16" fill="black" fill-opacity="0.7"/>
                        <path d="M9.33337 12C9.33337 11.6319 9.63185 11.3334 10 11.3334H22C22.3682 11.3334 22.6667 11.6319 22.6667 12C22.6667 12.3682 22.3682 12.6667 22 12.6667H10C9.63185 12.6667 9.33337 12.3682 9.33337 12Z" fill="white"/>
                        <path fill-rule="evenodd" d="M14.6666 9.99996C14.4898 9.99996 14.3202 10.0702 14.1952 10.1952C14.0702 10.3202 14 10.4898 14 10.6666V11.3333H18V10.6666C18 10.4898 17.9297 10.3202 17.8047 10.1952C17.6797 10.0702 17.5101 9.99996 17.3333 9.99996H14.6666ZM19.3333 11.3333V10.6666C19.3333 10.1362 19.1226 9.62748 18.7475 9.25241C18.3724 8.87734 17.8637 8.66663 17.3333 8.66663H14.6666C14.1362 8.66663 13.6275 8.87734 13.2524 9.25241C12.8773 9.62748 12.6666 10.1362 12.6666 10.6666V11.3333H11.3333C10.9651 11.3333 10.6666 11.6318 10.6666 12V21.3333C10.6666 21.8637 10.8773 22.3724 11.2524 22.7475C11.6275 23.1226 12.1362 23.3333 12.6666 23.3333H19.3333C19.8637 23.3333 20.3724 23.1226 20.7475 22.7475C21.1226 22.3724 21.3333 21.8637 21.3333 21.3333V12C21.3333 11.6318 21.0348 11.3333 20.6666 11.3333H19.3333ZM12 12.6666V21.3333C12 21.5101 12.0702 21.6797 12.1952 21.8047C12.3202 21.9297 12.4898 22 12.6666 22H19.3333C19.5101 22 19.6797 21.9297 19.8047 21.8047C19.9297 21.6797 20 21.5101 20 21.3333V12.6666H12Z" fill="white"/>
                        </svg>
                    </div>
                </div>
            </div>`;
            $("#" + settings.attachmentId + '-items').append(imageRender);
            modalContainer.find(".image-preview-layout").addClass('hidden');
            modalContainer.find(".tab-image-layout").removeClass('hidden');
            modalContainer.find("#upload-file").val("");
            // $(".V2-comment-input-suggest-group").removeClass('active');
            let attachmentObj = {
                type : 'image',
                id : id,
                src : src,
                is_pending: 0,
                hash: modalContainer.find('.image-preview').data('hash')
            };
            editor.insertAttachments(attachmentObj);
        }

        var insertLink = function(url, source = Quill.sources.API, callback) {
            if (source === Quill.sources.API) {
                var selectLinkId = modalContainer.find('.tab-link-suggest-layout').attr('data-id');

                if (! selectLinkId && linkDataResponse) {
                    var linkId = insertAttachmentLink(url, source).id;
                    resizeAttachmentLink(linkId);

                    return;
                }

                if (selectLinkId) {
                    updateAttachmentLink(selectLinkId, source);
                    resizeAttachmentLink(selectLinkId);
                    modalContainer.find('.tab-link-suggest-layout').removeAttr('data-id');
                }

                linkDataResponse = null;
            } else {
                $.ajaxq('url_info', {
                    type: 'POST',
                    url: urls.info,
                    xhrFields: {withCredentials: true},
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-OSC-Cross-Request': 'OK'
                    },
                    data: {
                        url: url,
                        act: 'info',
                        request_type: 'ajax'
                    },
                    dataType: 'json',
                    beforeSend: function() {
                        modalContainer.find('#loading').removeClass('hidden');
                    },
                    success: function(response) {
                        modalContainer.find('#loading').addClass('hidden');

                        if (typeof callback == 'function') {
                            callback();
                        }

                        if (response.result !== 'OK') {
                            console.log(response.message);
                            $(editor).find("a[href='" + url + "']:not([data-id])").removeClass('loading');
                        } else {
                            if (response.info.title == null || response.info.domain == null || response.info.url == null) {
                                return false;
                            }

                            linkDataResponse = {
                                data: {
                                    title: response.info.title,
                                    domain: response.info.domain,
                                    url: response.info.url,
                                    image_src: response.info.images.length > 0 ? response.info.images[0][0] : '',
                                }
                            };

                            if (typeof(response.info.embed.code) !== 'undefined') {
                                linkDataResponse.data.embed_code = response.info.embed.code;
                            }

                            var linkId = insertAttachmentLink(url, source).id;
                            linkDataResponse.data.embed_code ?  $('#' + linkId).find('.attachment-link-tab[data-tab="tab-3"]').click()
                                :   $('#' + linkId).find('.attachment-link-tab[data-tab="tab-1"]').click();

                            resizeAttachmentLink(linkId);
                        }
                    }
                })
            }
        };

        var insertAttachmentLink = function (url, source) {
            const id = new Date().getTime();
            const styleEmbedId = 3;
            let styleId = modalContainer.find('.tab-link-suggest-header .tab-link-suggest-tab.active').data('tab');
            styleId = styleId.replace('style-', '');
            styleId = (typeof(linkDataResponse.data.embed_code) !== 'undefined' && source !== Quill.sources.API) ? styleEmbedId : styleId;
            let attachmentObj = {
                type: 'link',
                id: id,
                src: linkDataResponse.data.url,
                domain: linkDataResponse.data.domain,
                is_pending: 1,
                style: styleId,
                title: linkDataResponse.data.title,
                image_src: linkDataResponse.data.image_src,
                embed_code: typeof(linkDataResponse.data.embed_code) !== 'undefined' ? linkDataResponse.data.embed_code : ''
            };

            const linkRender = renderAttachmentLink(linkDataResponse, id, source);
            let link = $(linkRender);
            link.find('.attachment-link-tab').removeClass('active');
            link.find(`.attachment-link-tab[data-tab="tab-${styleId}"]`).addClass('active');
            link.find('.attachment-link-content').removeClass('active');
            link.find('.attachment-link-layout').find(`.tab-${styleId}`).addClass('active');
            if (attachmentObj.style == 1) link.find('.footer .tab-1').addClass('active');

            $("#" + settings.attachmentId + '-items').append(link);

            //loading success
            $(editor).find("a[href='" + url + "']:not([data-id])").removeClass('loading').attr('data-id', id);

            editor.insertAttachments(attachmentObj, function () {
                if (source == Quill.sources.API) {
                    $('#' + id, $(editor)).find('.attachment-insert-button').click();
                }
            });

            return attachmentObj;
        }

        var updateAttachmentLink = function (id, source) {

            let styleId = modalContainer.find('.tab-link-suggest-header .tab-link-suggest-tab.active').data('tab').replace('style-', '');

            var link = $("#" + settings.attachmentId + '-items #' + id);

            if (! linkDataResponse) {
                editor.updateAttachmentField(id, 'style', styleId);
                link.find(`.attachment-link-tab[data-tab='tab-${styleId}']`).click();
                link.removeClass('tab-3');
                if (styleId == 3) {
                    link.addClass('tab-3');
                }

                return;
            }

            const linkRender = renderAttachmentLink(linkDataResponse, id, source);
            link.after(linkRender);
            link.remove();

            let attachmentObj = {
                src: linkDataResponse.data.url,
                domain: linkDataResponse.data.domain,
                is_pending: 0,
                style: styleId,
                title: linkDataResponse.data.title,
                image_src: linkDataResponse.data.image_src,
                embed_code: typeof(linkDataResponse.data.embed_code) !== 'undefined' ? linkDataResponse.data.embed_code : ''
            };

            var attachmentLink = editor.find('#' + id);

            editor.updateAttachmentById(id, attachmentObj, function() {
                attachmentLink.find(`.attachment-link-tab[data-tab='tab-${styleId}']`).click();
                attachmentLink.find('.attachment-insert-button').click();
            })
        }

        var renderAttachmentLink = function (linkDataResponse, id, source = Quill.sources.API) {
            return `<div class="link-list" id='${id}'>
            <div class="attachment-link-header">
                <span class="comment-suggest-label"></span>
                <div class="attachment-link-group-tab">
                    <div class="attachment-link-tab active" data-tab="tab-1">
                        <svg width="20" height="4" viewBox="0 0 20 4" fill="#E5E5E5" xmlns="http://www.w3.org/2000/svg" style="margin: 12px 15px 11px;">
                            <rect id="Rectangle 117" width="20" height="1"/>
                            <rect id="Rectangle 118" y="3" width="9" height="1"/>
                        </svg>
                    </div>
                    <div class="attachment-link-tab" data-tab="tab-2">
                        <svg width="20" height="6" viewBox="0 0 20 6" fill="#E5E5E5" xmlns="http://www.w3.org/2000/svg" style="margin: 11px 15px 10px;">
                            <rect x="10" y="1" width="10" height="1"/>
                            <rect x="10" y="3" width="9" height="1"/>
                            <rect width="9" height="6"/>
                        </svg>
                    </div>`
                + (linkDataResponse.data.embed_code ? `<div class="attachment-link-tab video" data-tab="tab-3">
                        <svg class="tab-icon" width="50" height="27" viewBox="0 0 50 27" fill="#E5E5E5" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M27.0956 10.1674C27.3441 9.94421 27.747 9.94421 27.9955 10.1674L31.8137 13.5959C32.0622 13.8191 32.0622 14.1809 31.8137 14.4041L27.9955 17.8326C27.747 18.0558 27.3441 18.0558 27.0956 17.8326C26.8471 17.6095 26.8471 17.2477 27.0956 17.0245L30.4638 14L27.0956 10.9755C26.8471 10.7523 26.8471 10.3905 27.0956 10.1674Z"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M22.9045 10.1674C23.153 10.3905 23.153 10.7523 22.9045 10.9755L19.5363 14L22.9045 17.0245C23.153 17.2477 23.153 17.6095 22.9045 17.8326C22.656 18.0558 22.2531 18.0558 22.0046 17.8326L18.1864 14.4041C17.9379 14.1809 17.9379 13.8191 18.1864 13.5959L22.0046 10.1674C22.2531 9.94421 22.656 9.94421 22.9045 10.1674Z"/>
                        </svg>
                    </div>` : '')
                + `</div>
                <div style="display: flex;">
                    <button class="attachment-insert-button">
                        <svg width="10" height="7" viewBox="0 0 10 7" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9.83728 0.157712C10.0542 0.367994 10.0542 0.708929 9.83728 0.919211L3.72617 6.84229C3.50921 7.05257 3.15745 7.05257 2.9405 6.84229L0.162718 4.14998C-0.0542395 3.9397 -0.0542395 3.59876 0.162718 3.38848C0.379676 3.1782 0.731435 3.1782 0.948393 3.38848L3.33333 5.70004L9.05161 0.157712C9.26857 -0.0525706 9.62032 -0.0525706 9.83728 0.157712Z" fill="#333333"/>
                        </svg><span class="label">Chèn mẫu</span>
                    </button>
                    <button class="attachment-skip-button attachment-link-remove">
                        <svg width="8" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0)">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M7.83263 0.667368C8.05579 0.890524 8.05579 1.25233 7.83263 1.47549L0.97549 8.33263C0.752333 8.55579 0.390524 8.55579 0.167368 8.33263C-0.0557892 8.10948 -0.0557892 7.74767 0.167368 7.52451L7.02451 0.667368C7.24767 0.444211 7.60948 0.444211 7.83263 0.667368Z" fill="#AAAAAA"/>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M0.167368 0.667368C0.390524 0.444211 0.752333 0.444211 0.97549 0.667368L7.83263 7.52451C8.05579 7.74767 8.05579 8.10948 7.83263 8.33263C7.60948 8.55579 7.24767 8.55579 7.02451 8.33263L0.167368 1.47549C-0.0557892 1.25233 -0.0557892 0.890524 0.167368 0.667368Z" fill="#AAAAAA"/>
                            </g>
                            <defs>
                            <clipPath id="clip0">
                            <rect width="8" height="8" fill="white" transform="translate(0 0.5)"/>
                            </clipPath>
                            </defs>
                            </svg>
                        <span class="label">Bỏ qua</span>
                    </button>
                </div>
            </div>
            <div class="attachment-link-header-success hidden">
                <div style="display: flex;">
                    <button class="attachment-reconfig-button" data-source=${source}>
                        <svg width="12" height="13" viewBox="0 0 12 13" fill="#333333" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 5.5C5.44772 5.5 5 5.94772 5 6.5C5 7.05228 5.44772 7.5 6 7.5C6.55228 7.5 7 7.05228 7 6.5C7 5.94772 6.55228 5.5 6 5.5ZM4 6.5C4 5.39543 4.89543 4.5 6 4.5C7.10457 4.5 8 5.39543 8 6.5C8 7.60457 7.10457 8.5 6 8.5C4.89543 8.5 4 7.60457 4 6.5Z"/>
                        <path d="M6 1.5C5.86739 1.5 5.74022 1.55268 5.64645 1.64645C5.55268 1.74022 5.5 1.86739 5.5 2V2.08699C5.49897 2.3454 5.4224 2.59786 5.27972 2.81331C5.13704 3.02875 4.93448 3.19778 4.69697 3.29957C4.65469 3.31769 4.61021 3.32985 4.56481 3.33578C4.34899 3.41136 4.11666 3.42999 3.8905 3.38898C3.63 3.34175 3.38963 3.21756 3.20037 3.03243L3.19642 3.02857L3.16645 2.99855C3.12001 2.95206 3.06467 2.91499 3.00397 2.88983C2.94327 2.86466 2.87821 2.85171 2.8125 2.85171C2.74679 2.85171 2.68173 2.86466 2.62103 2.88983C2.56033 2.91499 2.50519 2.95187 2.45875 2.99836L2.45836 2.99875C2.41187 3.04519 2.37499 3.10033 2.34983 3.16103C2.32466 3.22173 2.31171 3.28679 2.31171 3.3525C2.31171 3.41821 2.32466 3.48327 2.34983 3.54397C2.37499 3.60467 2.41187 3.65981 2.45836 3.70625L2.49245 3.74035C2.67758 3.9296 2.80175 4.17 2.84898 4.4305C2.89527 4.68581 2.86556 4.94898 2.76373 5.18739C2.67094 5.43066 2.50849 5.64134 2.29652 5.79294C2.08027 5.94761 1.82249 6.03365 1.55669 6.03986L1.545 6.04H1.5C1.36739 6.04 1.24022 6.09268 1.14645 6.18645C1.05268 6.28022 1 6.40739 1 6.54C1 6.67261 1.05268 6.79978 1.14645 6.89355C1.24022 6.98732 1.36739 7.04 1.5 7.04H1.58699C1.8454 7.04103 2.09786 7.1176 2.31331 7.26028C2.528 7.40246 2.6966 7.60412 2.79851 7.84056C2.90454 8.08213 2.93605 8.34988 2.88898 8.6095C2.84175 8.87 2.71756 9.11037 2.53243 9.29963L2.52857 9.30358L2.49855 9.33355C2.45206 9.37999 2.41499 9.43533 2.38983 9.49603C2.36466 9.55673 2.35171 9.62179 2.35171 9.6875C2.35171 9.75321 2.36466 9.81827 2.38983 9.87897C2.41499 9.93967 2.45187 9.99481 2.49836 10.0413L2.49875 10.0416C2.54519 10.0881 2.60033 10.125 2.66103 10.1502C2.72173 10.1753 2.78679 10.1883 2.8525 10.1883C2.91821 10.1883 2.98327 10.1753 3.04397 10.1502C3.10467 10.125 3.15981 10.0881 3.20625 10.0416L3.24035 10.0075C3.4296 9.82242 3.67 9.69825 3.9305 9.65102C4.18581 9.60473 4.44898 9.63443 4.68738 9.73627C4.93066 9.82905 5.14133 9.99151 5.29294 10.2035C5.44761 10.4197 5.53365 10.6775 5.53986 10.9433L5.54 10.955V11C5.54 11.1326 5.59268 11.2598 5.68645 11.3536C5.78022 11.4473 5.90739 11.5 6.04 11.5C6.17261 11.5 6.29978 11.4473 6.39355 11.3536C6.48732 11.2598 6.54 11.1326 6.54 11V10.915L6.54 10.913C6.54103 10.6546 6.6176 10.4021 6.76028 10.1867C6.90248 9.97198 7.10415 9.80337 7.34062 9.70147C7.58217 9.59545 7.8499 9.56395 8.1095 9.61102C8.37 9.65825 8.61037 9.78244 8.79963 9.96757L8.80357 9.97143L8.83355 10.0014C8.87999 10.0479 8.93533 10.085 8.99603 10.1102C9.05673 10.1353 9.12179 10.1483 9.1875 10.1483C9.25321 10.1483 9.31827 10.1353 9.37897 10.1102C9.43967 10.085 9.49481 10.0481 9.54125 10.0016L9.54164 10.0012C9.58813 9.95481 9.62501 9.89967 9.65017 9.83897C9.67534 9.77827 9.68829 9.71321 9.68829 9.6475C9.68829 9.58179 9.67534 9.51673 9.65017 9.45603C9.62501 9.39533 9.58813 9.34018 9.54164 9.29375L9.50755 9.25965C9.32242 9.0704 9.19825 8.83 9.15102 8.5695C9.10395 8.3099 9.13545 8.04217 9.24147 7.80062C9.34337 7.56415 9.51198 7.36248 9.72669 7.22028C9.94214 7.0776 10.1946 7.00103 10.453 7L10.455 7L10.5 7C10.6326 7 10.7598 6.94732 10.8536 6.85355C10.9473 6.75978 11 6.63261 11 6.5C11 6.36739 10.9473 6.24022 10.8536 6.14645C10.7598 6.05268 10.6326 6 10.5 6H10.415L10.413 6C10.1546 5.99897 9.90214 5.9224 9.68669 5.77972C9.47125 5.63704 9.30223 5.43448 9.20043 5.19697C9.18231 5.15469 9.17015 5.11021 9.16422 5.0648C9.08864 4.84899 9.07001 4.61666 9.11102 4.3905C9.15825 4.13 9.28244 3.88963 9.46757 3.70037L9.47142 3.69643L9.50144 3.66645C9.54793 3.62001 9.58501 3.56467 9.61017 3.50397C9.63534 3.44327 9.64829 3.37821 9.64829 3.3125C9.64829 3.24679 9.63534 3.18173 9.61017 3.12103C9.58501 3.06033 9.54813 3.00519 9.50164 2.95875L9.50125 2.95836C9.45481 2.91187 9.39967 2.87499 9.33897 2.84983C9.27827 2.82466 9.21321 2.81171 9.1475 2.81171C9.08179 2.81171 9.01673 2.82466 8.95603 2.84983C8.89533 2.87499 8.84019 2.91187 8.79375 2.95836L8.75965 2.99245C8.5704 3.17758 8.33 3.30175 8.0695 3.34898C7.80988 3.39605 7.54213 3.36454 7.30056 3.25851C7.06412 3.1566 6.86246 2.988 6.72028 2.77331C6.5776 2.55786 6.50103 2.3054 6.5 2.04699L6.5 2.045V2C6.5 1.86739 6.44732 1.74022 6.35355 1.64645C6.25978 1.55268 6.13261 1.5 6 1.5ZM9.7 8L10.1574 8.20188C10.1312 8.26129 10.1234 8.32719 10.135 8.39109C10.1464 8.45428 10.1764 8.51265 10.2209 8.55883L10.2484 8.58625C10.2483 8.58619 10.2484 8.58631 10.2484 8.58625C10.3877 8.72552 10.4985 8.89108 10.5739 9.07309C10.6494 9.25519 10.6883 9.45038 10.6883 9.6475C10.6883 9.84462 10.6494 10.0398 10.5739 10.2219C10.4985 10.404 10.3878 10.5694 10.2484 10.7087L9.895 10.355L10.2488 10.7084C10.1094 10.8478 9.94401 10.9585 9.76191 11.0339C9.57981 11.1094 9.38462 11.1483 9.1875 11.1483C8.99038 11.1483 8.79519 11.1094 8.61309 11.0339C8.43108 10.9585 8.26571 10.8479 8.12645 10.7086C8.12651 10.7086 8.12638 10.7085 8.12645 10.7086L8.09883 10.6809C8.05265 10.6364 7.99428 10.6064 7.93109 10.595C7.86719 10.5834 7.80129 10.5912 7.74188 10.6174L7.73698 10.6196C7.67872 10.6446 7.62902 10.686 7.59403 10.7388C7.55917 10.7915 7.5404 10.8531 7.54 10.9163V11C7.54 11.3978 7.38196 11.7794 7.10066 12.0607C6.81936 12.342 6.43783 12.5 6.04 12.5C5.64217 12.5 5.26064 12.342 4.97934 12.0607C4.69804 11.7794 4.54 11.3978 4.54 11V10.9622C4.53763 10.8986 4.51663 10.837 4.47957 10.7852C4.44163 10.7322 4.38861 10.6918 4.32741 10.6693C4.31752 10.6656 4.30775 10.6617 4.29812 10.6574C4.23871 10.6312 4.17281 10.6234 4.10891 10.635C4.04571 10.6464 3.98733 10.6764 3.94115 10.721L3.91375 10.7484C3.91381 10.7483 3.91369 10.7484 3.91375 10.7484C3.77448 10.8877 3.60892 10.9985 3.42691 11.0739C3.24481 11.1494 3.04962 11.1883 2.8525 11.1883C2.65538 11.1883 2.46019 11.1494 2.27809 11.0739C2.09617 10.9985 1.93087 10.888 1.79164 10.7488C1.65218 10.6094 1.54154 10.444 1.46605 10.2619C1.39057 10.0798 1.35171 9.88462 1.35171 9.6875C1.35171 9.49038 1.39057 9.29519 1.46605 9.11309C1.54154 8.93099 1.65218 8.76556 1.79164 8.62625L1.81906 8.59884C1.86364 8.55265 1.89357 8.49429 1.90502 8.43109C1.91661 8.36719 1.90879 8.30129 1.88257 8.24188L1.8804 8.23698C1.85544 8.17872 1.814 8.12902 1.76116 8.09403C1.70852 8.05917 1.64687 8.0404 1.58375 8.04H1.5C1.10217 8.04 0.720644 7.88196 0.43934 7.60066C0.158035 7.31936 0 6.93782 0 6.54C0 6.14218 0.158035 5.76064 0.43934 5.47934C0.720644 5.19804 1.10217 5.04 1.5 5.04H1.53782C1.60142 5.03763 1.66296 5.01663 1.71478 4.97957C1.76782 4.94163 1.80822 4.88862 1.83073 4.82741C1.83437 4.81752 1.83832 4.80775 1.84257 4.79812C1.86879 4.73871 1.87661 4.67281 1.86502 4.60891C1.85356 4.54571 1.82364 4.48734 1.77905 4.44116L1.75164 4.41375C1.61218 4.27444 1.50154 4.10901 1.42605 3.92691C1.35057 3.74481 1.31171 3.54962 1.31171 3.3525C1.31171 3.15538 1.35057 2.96019 1.42605 2.77809C1.5015 2.59608 1.61207 2.43072 1.75145 2.29145C1.89072 2.15207 2.05608 2.0415 2.23809 1.96605C2.42019 1.89057 2.61538 1.85171 2.8125 1.85171C3.00962 1.85171 3.20481 1.89057 3.38691 1.96605C3.56901 2.04154 3.73444 2.15218 3.87375 2.29164L3.90115 2.31905C3.94734 2.36364 4.00571 2.39356 4.06891 2.40502C4.13281 2.41661 4.19871 2.40879 4.25812 2.38257C4.29014 2.36844 4.32346 2.35775 4.35754 2.35061C4.3924 2.32695 4.42249 2.29662 4.44597 2.26116C4.48083 2.20852 4.4996 2.14687 4.5 2.08375V2C4.5 1.60217 4.65804 1.22064 4.93934 0.93934C5.22064 0.658035 5.60218 0.5 6 0.5C6.39782 0.5 6.77936 0.658035 7.06066 0.93934C7.34196 1.22064 7.5 1.60217 7.5 2V2.04375C7.5004 2.10687 7.51917 2.16852 7.55403 2.22116C7.58902 2.274 7.63871 2.31546 7.69697 2.34043L7.70189 2.34254C7.7613 2.36876 7.82719 2.37661 7.89109 2.36502C7.95429 2.35357 8.01265 2.32364 8.05884 2.27906L8.08625 2.25164C8.22556 2.11218 8.39099 2.00154 8.57309 1.92605C8.75519 1.85057 8.95038 1.81171 9.1475 1.81171C9.34462 1.81171 9.53981 1.85057 9.72191 1.92605C9.90401 2.00154 10.0694 2.11218 10.2087 2.25164C10.348 2.39087 10.4585 2.55616 10.5339 2.73809C10.6094 2.92019 10.6483 3.11538 10.6483 3.3125C10.6483 3.50962 10.6094 3.70481 10.5339 3.88691C10.4585 4.06892 10.3479 4.23428 10.2086 4.37355C10.2086 4.37349 10.2085 4.37362 10.2086 4.37355L10.181 4.40115C10.1364 4.44734 10.1064 4.50571 10.095 4.56891C10.0834 4.63281 10.0912 4.69871 10.1174 4.75812C10.1316 4.79014 10.1423 4.82346 10.1494 4.85753C10.1731 4.8924 10.2034 4.92249 10.2388 4.94597C10.2915 4.98083 10.3531 4.9996 10.4163 5H10.5C10.8978 5 11.2794 5.15804 11.5607 5.43934C11.842 5.72064 12 6.10217 12 6.5C12 6.89783 11.842 7.27936 11.5607 7.56066C11.2794 7.84196 10.8978 8 10.5 8H10.4563C10.3931 8.0004 10.3315 8.01917 10.2788 8.05403C10.226 8.08902 10.1845 8.13871 10.1596 8.19697L9.7 8Z" />
                        </svg><span class="label">Tùy chỉnh</span>
                    </button>
                    <button class="attachment-delete-button attachment-link-remove">
                        <svg width="10" height="11" viewBox="0 0 10 11" fill="#333333" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 2.7729C0 2.52187 0.223858 2.31836 0.5 2.31836H9.5C9.77614 2.31836 10 2.52187 10 2.7729C10 3.02394 9.77614 3.22745 9.5 3.22745H0.5C0.223858 3.22745 0 3.02394 0 2.7729Z" />
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4 1.40909C3.86739 1.40909 3.74021 1.45698 3.64645 1.54222C3.55268 1.62747 3.5 1.74308 3.5 1.86364V2.31818H6.5V1.86364C6.5 1.74308 6.44732 1.62747 6.35355 1.54222C6.25978 1.45698 6.13261 1.40909 6 1.40909H4ZM7.5 2.31818V1.86364C7.5 1.50198 7.34196 1.15513 7.06066 0.8994C6.77936 0.643668 6.39782 0.5 6 0.5H4C3.60217 0.5 3.22064 0.643668 2.93934 0.8994C2.65804 1.15513 2.5 1.50198 2.5 1.86364V2.31818H1.5C1.22386 2.31818 1 2.52169 1 2.77273V9.13636C1 9.49802 1.15804 9.84487 1.43934 10.1006C1.72064 10.3563 2.10217 10.5 2.5 10.5H7.5C7.89782 10.5 8.27936 10.3563 8.56066 10.1006C8.84196 9.84487 9 9.49802 9 9.13636V2.77273C9 2.52169 8.77614 2.31818 8.5 2.31818H7.5ZM2 3.22727V9.13636C2 9.25692 2.05268 9.37253 2.14645 9.45778C2.24021 9.54302 2.36739 9.59091 2.5 9.59091H7.5C7.63261 9.59091 7.75978 9.54302 7.85355 9.45778C7.94732 9.37253 8 9.25692 8 9.13636V3.22727H2Z"/>
                        </svg><span class="label">Xóa</span>
                    </button>
                </div>
            </div>
            <div style="display: flex; flex-direction: column;">
                <div class="attachment-link-layout">
                    <div class="attachment-link-content tab-1 active">
                        <span class="attachment-link-title style-1">
                            ${linkDataResponse.data.title} <svg width="8" height="8" viewBox="0 0 8 8" fill="#AAAAAA" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1.2 2C1.09391 2 0.992172 2.04214 0.917157 2.11716C0.842143 2.19217 0.8 2.29391 0.8 2.4V6.8C0.8 6.90609 0.842143 7.00783 0.917157 7.08284C0.992172 7.15786 1.09391 7.2 1.2 7.2H5.6C5.70609 7.2 5.80783 7.15786 5.88284 7.08284C5.95786 7.00783 6 6.90609 6 6.8V4.4C6 4.17909 6.17909 4 6.4 4C6.62091 4 6.8 4.17909 6.8 4.4V6.8C6.8 7.11826 6.67357 7.42348 6.44853 7.64853C6.22348 7.87357 5.91826 8 5.6 8H1.2C0.88174 8 0.576515 7.87357 0.351472 7.64853C0.126428 7.42348 0 7.11826 0 6.8V2.4C0 2.08174 0.126428 1.77652 0.351472 1.55147C0.576515 1.32643 0.88174 1.2 1.2 1.2H3.6C3.82091 1.2 4 1.37909 4 1.6C4 1.82091 3.82091 2 3.6 2H1.2Z"/>
                            <path d="M4.8 0.4C4.8 0.179086 4.97909 1.19209e-08 5.2 1.19209e-08H7.6C7.82091 1.19209e-08 8 0.179086 8 0.4V2.8C8 3.02091 7.82091 3.2 7.6 3.2C7.37909 3.2 7.2 3.02091 7.2 2.8V0.8H5.2C4.97909 0.8 4.8 0.620914 4.8 0.4Z"/>
                            <path d="M7.88284 0.117157C8.03905 0.273367 8.03905 0.526633 7.88284 0.682843L4.85427 3.71141C4.69806 3.86762 4.4448 3.86762 4.28859 3.71141C4.13238 3.5552 4.13238 3.30194 4.28859 3.14573L7.31716 0.117157C7.47337 -0.0390524 7.72663 -0.0390524 7.88284 0.117157Z"/>
                            </svg>
                        </span>
                        <span class="attachment-link-url style-1">${linkDataResponse.data.domain}</span>
                    </div>
                    <div class="attachment-link-content tab-2" style="flex-direction: row;">
                        <img class="attachment-link-image" src="${linkDataResponse.data.image_src}">
                        <div class="attachment-link-text">
                            <span class="attachment-link-title style-2">
                                ${linkDataResponse.data.title} <svg width="8" height="8" viewBox="0 0 8 8" fill="#AAAAAA" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1.2 2C1.09391 2 0.992172 2.04214 0.917157 2.11716C0.842143 2.19217 0.8 2.29391 0.8 2.4V6.8C0.8 6.90609 0.842143 7.00783 0.917157 7.08284C0.992172 7.15786 1.09391 7.2 1.2 7.2H5.6C5.70609 7.2 5.80783 7.15786 5.88284 7.08284C5.95786 7.00783 6 6.90609 6 6.8V4.4C6 4.17909 6.17909 4 6.4 4C6.62091 4 6.8 4.17909 6.8 4.4V6.8C6.8 7.11826 6.67357 7.42348 6.44853 7.64853C6.22348 7.87357 5.91826 8 5.6 8H1.2C0.88174 8 0.576515 7.87357 0.351472 7.64853C0.126428 7.42348 0 7.11826 0 6.8V2.4C0 2.08174 0.126428 1.77652 0.351472 1.55147C0.576515 1.32643 0.88174 1.2 1.2 1.2H3.6C3.82091 1.2 4 1.37909 4 1.6C4 1.82091 3.82091 2 3.6 2H1.2Z"/>
                                <path d="M4.8 0.4C4.8 0.179086 4.97909 1.19209e-08 5.2 1.19209e-08H7.6C7.82091 1.19209e-08 8 0.179086 8 0.4V2.8C8 3.02091 7.82091 3.2 7.6 3.2C7.37909 3.2 7.2 3.02091 7.2 2.8V0.8H5.2C4.97909 0.8 4.8 0.620914 4.8 0.4Z"/>
                                <path d="M7.88284 0.117157C8.03905 0.273367 8.03905 0.526633 7.88284 0.682843L4.85427 3.71141C4.69806 3.86762 4.4448 3.86762 4.28859 3.71141C4.13238 3.5552 4.13238 3.30194 4.28859 3.14573L7.31716 0.117157C7.47337 -0.0390524 7.72663 -0.0390524 7.88284 0.117157Z"/>
                                </svg>
                            </span>
                            <span class="attachment-link-url style-2">${linkDataResponse.data.domain}</span>
                        </div>
                    </div>`

                + (linkDataResponse.data.embed_code ? `<div class="attachment-link-content tab-3 video" style="flex-direction: column;">
                        <div class="attachment-link-embed">${linkDataResponse.data.embed_code}</div>
                        <div class="attachment-link-text" style="margin-top: 10px">
                            <span class="attachment-link-title style-2">
                                ${linkDataResponse.data.title} <svg width="8" height="8" viewBox="0 0 8 8" fill="#AAAAAA" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1.2 2C1.09391 2 0.992172 2.04214 0.917157 2.11716C0.842143 2.19217 0.8 2.29391 0.8 2.4V6.8C0.8 6.90609 0.842143 7.00783 0.917157 7.08284C0.992172 7.15786 1.09391 7.2 1.2 7.2H5.6C5.70609 7.2 5.80783 7.15786 5.88284 7.08284C5.95786 7.00783 6 6.90609 6 6.8V4.4C6 4.17909 6.17909 4 6.4 4C6.62091 4 6.8 4.17909 6.8 4.4V6.8C6.8 7.11826 6.67357 7.42348 6.44853 7.64853C6.22348 7.87357 5.91826 8 5.6 8H1.2C0.88174 8 0.576515 7.87357 0.351472 7.64853C0.126428 7.42348 0 7.11826 0 6.8V2.4C0 2.08174 0.126428 1.77652 0.351472 1.55147C0.576515 1.32643 0.88174 1.2 1.2 1.2H3.6C3.82091 1.2 4 1.37909 4 1.6C4 1.82091 3.82091 2 3.6 2H1.2Z"/>
                                <path d="M4.8 0.4C4.8 0.179086 4.97909 1.19209e-08 5.2 1.19209e-08H7.6C7.82091 1.19209e-08 8 0.179086 8 0.4V2.8C8 3.02091 7.82091 3.2 7.6 3.2C7.37909 3.2 7.2 3.02091 7.2 2.8V0.8H5.2C4.97909 0.8 4.8 0.620914 4.8 0.4Z"/>
                                <path d="M7.88284 0.117157C8.03905 0.273367 8.03905 0.526633 7.88284 0.682843L4.85427 3.71141C4.69806 3.86762 4.4448 3.86762 4.28859 3.71141C4.13238 3.5552 4.13238 3.30194 4.28859 3.14573L7.31716 0.117157C7.47337 -0.0390524 7.72663 -0.0390524 7.88284 0.117157Z"/>
                                </svg>
                            </span>
                            <span class="attachment-link-url style-2">${linkDataResponse.data.domain}</span>
                        </div>
                    </div>` : '')
                + `</div>
                <div class="footer">
                    <div class="tab tab-1"></div>
                    <div class="tab tab-2"></div>`
                + (linkDataResponse.data.embed_code ?  '<div class="tab tab-3 active"></div>' : '')
                + `</div>
            </div>
        </div>`;
        }
        var resizeAttachmentLink = function (linkId) {
            var attachmentContainer = $('#' + settings.attachmentId + '-items').find('.link-list#' + linkId);
            var videoTab = attachmentContainer.find('.attachment-link-content.tab-3');

            let linkIframe = attachmentContainer.find('iframe');
            if (linkIframe) {
                iframeWidth = linkIframe.attr('width');
                linkIframe.css({
                    width: iframeWidth,
                    height: iframeWidth * settings.aspectRatio.height / settings.aspectRatio.width
                });
                attachmentContainer.find('.attachment-link-text').css({ width: iframeWidth });
            }
        }
        var insertEmbed = function(embed) {
            const id = new Date().getTime();
            let dataEmbed = embed;

            const regexp = /<iframe[^>]+src=["|']+([^"|']+)["|']+[^>]*>.*?<\/iframe>/ig;
            const iframes = [...dataEmbed.matchAll(regexp)];
            if (iframes.length != 1) {
                alert('Vui lòng chỉ nhập 1 mã nhúng iframe!');
                return false;
            }
            dataEmbed = iframes[0][0];
            let source = iframes[0][1];
            if (source.indexOf('https://lotus.vn') >= 0 || source.indexOf('http://lotus.vn') >= 0) {
                dataEmbed += `<script src="https://statics.lotuscdn.vn/web/v1/embed/w.embedlink.js?v=` + (new Date).getTime() + `" async></script>`;
            }
            let dataEmbedEncode = encodeURIComponent(dataEmbed);

            let embedRender = embed ?
                `<div class="embed-list" id='${id}'>
                                    <div class="attachment-embed-header-success">
                                        <div style="display: flex;">
                                            <button class="attachment-embed-option" data-embed=${dataEmbedEncode}>
                                                <svg width="12" height="13" viewBox="0 0 12 13" fill="#333333" style="margin-right: 7px;" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M6 5.5C5.44772 5.5 5 5.94772 5 6.5C5 7.05228 5.44772 7.5 6 7.5C6.55228 7.5 7 7.05228 7 6.5C7 5.94772 6.55228 5.5 6 5.5ZM4 6.5C4 5.39543 4.89543 4.5 6 4.5C7.10457 4.5 8 5.39543 8 6.5C8 7.60457 7.10457 8.5 6 8.5C4.89543 8.5 4 7.60457 4 6.5Z"/>
                                                <path d="M6 1.5C5.86739 1.5 5.74022 1.55268 5.64645 1.64645C5.55268 1.74022 5.5 1.86739 5.5 2V2.08699C5.49897 2.3454 5.4224 2.59786 5.27972 2.81331C5.13704 3.02875 4.93448 3.19778 4.69697 3.29957C4.65469 3.31769 4.61021 3.32985 4.56481 3.33578C4.34899 3.41136 4.11666 3.42999 3.8905 3.38898C3.63 3.34175 3.38963 3.21756 3.20037 3.03243L3.19642 3.02857L3.16645 2.99855C3.12001 2.95206 3.06467 2.91499 3.00397 2.88983C2.94327 2.86466 2.87821 2.85171 2.8125 2.85171C2.74679 2.85171 2.68173 2.86466 2.62103 2.88983C2.56033 2.91499 2.50519 2.95187 2.45875 2.99836L2.45836 2.99875C2.41187 3.04519 2.37499 3.10033 2.34983 3.16103C2.32466 3.22173 2.31171 3.28679 2.31171 3.3525C2.31171 3.41821 2.32466 3.48327 2.34983 3.54397C2.37499 3.60467 2.41187 3.65981 2.45836 3.70625L2.49245 3.74035C2.67758 3.9296 2.80175 4.17 2.84898 4.4305C2.89527 4.68581 2.86556 4.94898 2.76373 5.18739C2.67094 5.43066 2.50849 5.64134 2.29652 5.79294C2.08027 5.94761 1.82249 6.03365 1.55669 6.03986L1.545 6.04H1.5C1.36739 6.04 1.24022 6.09268 1.14645 6.18645C1.05268 6.28022 1 6.40739 1 6.54C1 6.67261 1.05268 6.79978 1.14645 6.89355C1.24022 6.98732 1.36739 7.04 1.5 7.04H1.58699C1.8454 7.04103 2.09786 7.1176 2.31331 7.26028C2.528 7.40246 2.6966 7.60412 2.79851 7.84056C2.90454 8.08213 2.93605 8.34988 2.88898 8.6095C2.84175 8.87 2.71756 9.11037 2.53243 9.29963L2.52857 9.30358L2.49855 9.33355C2.45206 9.37999 2.41499 9.43533 2.38983 9.49603C2.36466 9.55673 2.35171 9.62179 2.35171 9.6875C2.35171 9.75321 2.36466 9.81827 2.38983 9.87897C2.41499 9.93967 2.45187 9.99481 2.49836 10.0413L2.49875 10.0416C2.54519 10.0881 2.60033 10.125 2.66103 10.1502C2.72173 10.1753 2.78679 10.1883 2.8525 10.1883C2.91821 10.1883 2.98327 10.1753 3.04397 10.1502C3.10467 10.125 3.15981 10.0881 3.20625 10.0416L3.24035 10.0075C3.4296 9.82242 3.67 9.69825 3.9305 9.65102C4.18581 9.60473 4.44898 9.63443 4.68738 9.73627C4.93066 9.82905 5.14133 9.99151 5.29294 10.2035C5.44761 10.4197 5.53365 10.6775 5.53986 10.9433L5.54 10.955V11C5.54 11.1326 5.59268 11.2598 5.68645 11.3536C5.78022 11.4473 5.90739 11.5 6.04 11.5C6.17261 11.5 6.29978 11.4473 6.39355 11.3536C6.48732 11.2598 6.54 11.1326 6.54 11V10.915L6.54 10.913C6.54103 10.6546 6.6176 10.4021 6.76028 10.1867C6.90248 9.97198 7.10415 9.80337 7.34062 9.70147C7.58217 9.59545 7.8499 9.56395 8.1095 9.61102C8.37 9.65825 8.61037 9.78244 8.79963 9.96757L8.80357 9.97143L8.83355 10.0014C8.87999 10.0479 8.93533 10.085 8.99603 10.1102C9.05673 10.1353 9.12179 10.1483 9.1875 10.1483C9.25321 10.1483 9.31827 10.1353 9.37897 10.1102C9.43967 10.085 9.49481 10.0481 9.54125 10.0016L9.54164 10.0012C9.58813 9.95481 9.62501 9.89967 9.65017 9.83897C9.67534 9.77827 9.68829 9.71321 9.68829 9.6475C9.68829 9.58179 9.67534 9.51673 9.65017 9.45603C9.62501 9.39533 9.58813 9.34018 9.54164 9.29375L9.50755 9.25965C9.32242 9.0704 9.19825 8.83 9.15102 8.5695C9.10395 8.3099 9.13545 8.04217 9.24147 7.80062C9.34337 7.56415 9.51198 7.36248 9.72669 7.22028C9.94214 7.0776 10.1946 7.00103 10.453 7L10.455 7L10.5 7C10.6326 7 10.7598 6.94732 10.8536 6.85355C10.9473 6.75978 11 6.63261 11 6.5C11 6.36739 10.9473 6.24022 10.8536 6.14645C10.7598 6.05268 10.6326 6 10.5 6H10.415L10.413 6C10.1546 5.99897 9.90214 5.9224 9.68669 5.77972C9.47125 5.63704 9.30223 5.43448 9.20043 5.19697C9.18231 5.15469 9.17015 5.11021 9.16422 5.0648C9.08864 4.84899 9.07001 4.61666 9.11102 4.3905C9.15825 4.13 9.28244 3.88963 9.46757 3.70037L9.47142 3.69643L9.50144 3.66645C9.54793 3.62001 9.58501 3.56467 9.61017 3.50397C9.63534 3.44327 9.64829 3.37821 9.64829 3.3125C9.64829 3.24679 9.63534 3.18173 9.61017 3.12103C9.58501 3.06033 9.54813 3.00519 9.50164 2.95875L9.50125 2.95836C9.45481 2.91187 9.39967 2.87499 9.33897 2.84983C9.27827 2.82466 9.21321 2.81171 9.1475 2.81171C9.08179 2.81171 9.01673 2.82466 8.95603 2.84983C8.89533 2.87499 8.84019 2.91187 8.79375 2.95836L8.75965 2.99245C8.5704 3.17758 8.33 3.30175 8.0695 3.34898C7.80988 3.39605 7.54213 3.36454 7.30056 3.25851C7.06412 3.1566 6.86246 2.988 6.72028 2.77331C6.5776 2.55786 6.50103 2.3054 6.5 2.04699L6.5 2.045V2C6.5 1.86739 6.44732 1.74022 6.35355 1.64645C6.25978 1.55268 6.13261 1.5 6 1.5ZM9.7 8L10.1574 8.20188C10.1312 8.26129 10.1234 8.32719 10.135 8.39109C10.1464 8.45428 10.1764 8.51265 10.2209 8.55883L10.2484 8.58625C10.2483 8.58619 10.2484 8.58631 10.2484 8.58625C10.3877 8.72552 10.4985 8.89108 10.5739 9.07309C10.6494 9.25519 10.6883 9.45038 10.6883 9.6475C10.6883 9.84462 10.6494 10.0398 10.5739 10.2219C10.4985 10.404 10.3878 10.5694 10.2484 10.7087L9.895 10.355L10.2488 10.7084C10.1094 10.8478 9.94401 10.9585 9.76191 11.0339C9.57981 11.1094 9.38462 11.1483 9.1875 11.1483C8.99038 11.1483 8.79519 11.1094 8.61309 11.0339C8.43108 10.9585 8.26571 10.8479 8.12645 10.7086C8.12651 10.7086 8.12638 10.7085 8.12645 10.7086L8.09883 10.6809C8.05265 10.6364 7.99428 10.6064 7.93109 10.595C7.86719 10.5834 7.80129 10.5912 7.74188 10.6174L7.73698 10.6196C7.67872 10.6446 7.62902 10.686 7.59403 10.7388C7.55917 10.7915 7.5404 10.8531 7.54 10.9163V11C7.54 11.3978 7.38196 11.7794 7.10066 12.0607C6.81936 12.342 6.43783 12.5 6.04 12.5C5.64217 12.5 5.26064 12.342 4.97934 12.0607C4.69804 11.7794 4.54 11.3978 4.54 11V10.9622C4.53763 10.8986 4.51663 10.837 4.47957 10.7852C4.44163 10.7322 4.38861 10.6918 4.32741 10.6693C4.31752 10.6656 4.30775 10.6617 4.29812 10.6574C4.23871 10.6312 4.17281 10.6234 4.10891 10.635C4.04571 10.6464 3.98733 10.6764 3.94115 10.721L3.91375 10.7484C3.91381 10.7483 3.91369 10.7484 3.91375 10.7484C3.77448 10.8877 3.60892 10.9985 3.42691 11.0739C3.24481 11.1494 3.04962 11.1883 2.8525 11.1883C2.65538 11.1883 2.46019 11.1494 2.27809 11.0739C2.09617 10.9985 1.93087 10.888 1.79164 10.7488C1.65218 10.6094 1.54154 10.444 1.46605 10.2619C1.39057 10.0798 1.35171 9.88462 1.35171 9.6875C1.35171 9.49038 1.39057 9.29519 1.46605 9.11309C1.54154 8.93099 1.65218 8.76556 1.79164 8.62625L1.81906 8.59884C1.86364 8.55265 1.89357 8.49429 1.90502 8.43109C1.91661 8.36719 1.90879 8.30129 1.88257 8.24188L1.8804 8.23698C1.85544 8.17872 1.814 8.12902 1.76116 8.09403C1.70852 8.05917 1.64687 8.0404 1.58375 8.04H1.5C1.10217 8.04 0.720644 7.88196 0.43934 7.60066C0.158035 7.31936 0 6.93782 0 6.54C0 6.14218 0.158035 5.76064 0.43934 5.47934C0.720644 5.19804 1.10217 5.04 1.5 5.04H1.53782C1.60142 5.03763 1.66296 5.01663 1.71478 4.97957C1.76782 4.94163 1.80822 4.88862 1.83073 4.82741C1.83437 4.81752 1.83832 4.80775 1.84257 4.79812C1.86879 4.73871 1.87661 4.67281 1.86502 4.60891C1.85356 4.54571 1.82364 4.48734 1.77905 4.44116L1.75164 4.41375C1.61218 4.27444 1.50154 4.10901 1.42605 3.92691C1.35057 3.74481 1.31171 3.54962 1.31171 3.3525C1.31171 3.15538 1.35057 2.96019 1.42605 2.77809C1.5015 2.59608 1.61207 2.43072 1.75145 2.29145C1.89072 2.15207 2.05608 2.0415 2.23809 1.96605C2.42019 1.89057 2.61538 1.85171 2.8125 1.85171C3.00962 1.85171 3.20481 1.89057 3.38691 1.96605C3.56901 2.04154 3.73444 2.15218 3.87375 2.29164L3.90115 2.31905C3.94734 2.36364 4.00571 2.39356 4.06891 2.40502C4.13281 2.41661 4.19871 2.40879 4.25812 2.38257C4.29014 2.36844 4.32346 2.35775 4.35754 2.35061C4.3924 2.32695 4.42249 2.29662 4.44597 2.26116C4.48083 2.20852 4.4996 2.14687 4.5 2.08375V2C4.5 1.60217 4.65804 1.22064 4.93934 0.93934C5.22064 0.658035 5.60218 0.5 6 0.5C6.39782 0.5 6.77936 0.658035 7.06066 0.93934C7.34196 1.22064 7.5 1.60217 7.5 2V2.04375C7.5004 2.10687 7.51917 2.16852 7.55403 2.22116C7.58902 2.274 7.63871 2.31546 7.69697 2.34043L7.70189 2.34254C7.7613 2.36876 7.82719 2.37661 7.89109 2.36502C7.95429 2.35357 8.01265 2.32364 8.05884 2.27906L8.08625 2.25164C8.22556 2.11218 8.39099 2.00154 8.57309 1.92605C8.75519 1.85057 8.95038 1.81171 9.1475 1.81171C9.34462 1.81171 9.53981 1.85057 9.72191 1.92605C9.90401 2.00154 10.0694 2.11218 10.2087 2.25164C10.348 2.39087 10.4585 2.55616 10.5339 2.73809C10.6094 2.92019 10.6483 3.11538 10.6483 3.3125C10.6483 3.50962 10.6094 3.70481 10.5339 3.88691C10.4585 4.06892 10.3479 4.23428 10.2086 4.37355C10.2086 4.37349 10.2085 4.37362 10.2086 4.37355L10.181 4.40115C10.1364 4.44734 10.1064 4.50571 10.095 4.56891C10.0834 4.63281 10.0912 4.69871 10.1174 4.75812C10.1316 4.79014 10.1423 4.82346 10.1494 4.85753C10.1731 4.8924 10.2034 4.92249 10.2388 4.94597C10.2915 4.98083 10.3531 4.9996 10.4163 5H10.5C10.8978 5 11.2794 5.15804 11.5607 5.43934C11.842 5.72064 12 6.10217 12 6.5C12 6.89783 11.842 7.27936 11.5607 7.56066C11.2794 7.84196 10.8978 8 10.5 8H10.4563C10.3931 8.0004 10.3315 8.01917 10.2788 8.05403C10.226 8.08902 10.1845 8.13871 10.1596 8.19697L9.7 8Z" />
                                                </svg><span class="label">Tùy chỉnh</span>
                                            </button>
                                            <button class="attachment-embed-delete">
                                                <svg width="10" height="11" viewBox="0 0 10 11" fill="#333333" style="margin-right: 7px;" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M0 2.7729C0 2.52187 0.223858 2.31836 0.5 2.31836H9.5C9.77614 2.31836 10 2.52187 10 2.7729C10 3.02394 9.77614 3.22745 9.5 3.22745H0.5C0.223858 3.22745 0 3.02394 0 2.7729Z" />
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M4 1.40909C3.86739 1.40909 3.74021 1.45698 3.64645 1.54222C3.55268 1.62747 3.5 1.74308 3.5 1.86364V2.31818H6.5V1.86364C6.5 1.74308 6.44732 1.62747 6.35355 1.54222C6.25978 1.45698 6.13261 1.40909 6 1.40909H4ZM7.5 2.31818V1.86364C7.5 1.50198 7.34196 1.15513 7.06066 0.8994C6.77936 0.643668 6.39782 0.5 6 0.5H4C3.60217 0.5 3.22064 0.643668 2.93934 0.8994C2.65804 1.15513 2.5 1.50198 2.5 1.86364V2.31818H1.5C1.22386 2.31818 1 2.52169 1 2.77273V9.13636C1 9.49802 1.15804 9.84487 1.43934 10.1006C1.72064 10.3563 2.10217 10.5 2.5 10.5H7.5C7.89782 10.5 8.27936 10.3563 8.56066 10.1006C8.84196 9.84487 9 9.49802 9 9.13636V2.77273C9 2.52169 8.77614 2.31818 8.5 2.31818H7.5ZM2 3.22727V9.13636C2 9.25692 2.05268 9.37253 2.14645 9.45778C2.24021 9.54302 2.36739 9.59091 2.5 9.59091H7.5C7.63261 9.59091 7.75978 9.54302 7.85355 9.45778C7.94732 9.37253 8 9.25692 8 9.13636V3.22727H2Z"/>
                                                </svg><span class="label">Xóa</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="embed-content">
                                        ${embed}
                                    </div>
                                </div>` : '<div class="embed-list"></div>';
            //disable embed button
            modalContainer.find('.tab.layer-1').removeAttr('disabled');
            if (embed) {
                editor.find('.ql-video').attr('disabled', true);
                modalContainer.find('#tab-embed-header').attr('disabled', true);
            }

            let embedListElement = $("#" + settings.attachmentId + '-items').find('.embed-list');
            let attachmentObj = {
                'type' : 'embed',
                'id' : id,
                'src' : embed,
                'is_pending': 0
            };
            if (embedListElement.length <= 0) {
                $("#" + settings.attachmentId + '-items').append(embedRender);

                editor.insertAttachments(attachmentObj);
            } else {
                embedListElement.empty();
                embedListElement.html(embedRender);
                editor.deleteAttachmentEmbed(attachmentObj);
                editor.insertAttachments(attachmentObj);
            }
        }

        var refreshModalImageSelect = function() {
            modalContainer.find('.modal-image').removeClass('hidden');
            modalContainer.find('.modal-layout-image').addClass('hidden');
            modalContainer.find('.modal-image.select-image').addClass('hidden');
            modalContainer.find('.modal-image-body.select-image').html('');
            modalContainer.find('.tab-link-delete-url').addClass('hidden');
            modalContainer.find('.tab-link-reset-url').addClass('hidden');
        };

        File.prototype.convertToBase64 = function (callback) {
            var reader = new FileReader();
            reader.onloadend = function (e) {
                callback(e.target.result, e.target.error);
            };
            reader.readAsDataURL(this);
        };

        return this.initialize();
    };
})(jQuery, window, document);
